<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Newton Method for the Steady Navier-Stokes equations</title>
		<link rel="icon" href="../_static/img/favicon.png">

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

		<!-- FreeFem++ theme specific -->
		<link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

		<!-- css -->
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

		<!-- js -->
		<script src="../_static/nav.json"></script>
		<script src="../_static/js/nav.js"></script>
		<script src="../_static/js/common.js"></script>

		<!-- MathJax -->
		<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
			<div class="header-logo">
    <div>
        <a href="../introduction/introduction.html">
            <img alt="logo" title="FreeFem++ documentation" src="../_static/img/Logo.png" />
        </a>
    </div>
</div>
<div class="header-title">
    <div>
        <a href="../introduction/introduction.html">
            <h2>FreeFem++ documentation</h2>
        </a>
    </div>
</div>
<div class="header-github">
    <a href="https://github.com/FreeFem/FreeFem-sources">
        <div class="header-github-img">
            <img alt="GitHub" title="FreeFem++ on GitHub" src="../_static/img/GitHub-Mark-120px-plus.png" />
        </div>
        <div class="header-github-title">
            <div class="header-github-title-text">
                FreeFem++ on GitHub
            </div>
            <div class="header-github-title-stars">
                <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
            </div>
        </div>
    </a>
</div>
<script src="../_static/js/github.js"></script>
		</header>
		
		<nav>
			<script>nav("../")</script>
			<div class="search">
				<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr_index.js"></script>

<script src="../_static/js/search.js"></script>

<div class="search">
    <input type="search" id="searchInput" placeholder="Search..." oninput="search(this.value);" />
    <div class="searchResults">
        <div id="resultCount">
        </div>
        <div id="searchResults">
        </div>
    </div>
</div>
			</div>
		</nav>
		

		
		<div class="container">
			<div class="toc" id="toc">
				<div>
					<ul>
<li><a class="reference internal" href="#">Newton Method for the Steady Navier-Stokes equations</a></li>
</ul>

				</div>
			</div>
			<div class="content">
				<div>
					
    <div class="section" id="newton-method-for-the-steady-navier-stokes-equations">
<h1>Newton Method for the Steady Navier-Stokes equations<a class="headerlink" href="#newton-method-for-the-steady-navier-stokes-equations" title="Permalink to this headline">Â¶</a></h1>
<p>The problem is find the velocity field <span class="math notranslate nohighlight">\(\mathbf{u}=(u_i)_{i=1}^d\)</span> and the pressure <span class="math notranslate nohighlight">\(p\)</span> of a Flow satisfying in the domain <span class="math notranslate nohighlight">\(\Omega \subset \mathbb{R}^d (d=2,3)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    (\mathbf{u}\cdot\nabla) \mathbf{u}-\nu \Delta \mathbf{u}+\nabla p&amp;=&amp;0\\
    \nabla\cdot \mathbf{u}&amp;=&amp;0
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\nu\)</span> is the viscosity of the fluid, <span class="math notranslate nohighlight">\(\nabla = (\partial_i )_{i=1}^d\)</span>, the dot product is <span class="math notranslate nohighlight">\(\cdot\)</span>, and <span class="math notranslate nohighlight">\(\Delta = \nabla\cdot\nabla\)</span> with the same boundary conditions (<span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is given on <span class="math notranslate nohighlight">\(\Gamma\)</span>).</p>
<p>The weak form is find <span class="math notranslate nohighlight">\(\mathbf{u}, p\)</span> such that for <span class="math notranslate nohighlight">\(\forall \mathbf{v}\)</span> (zero on <span class="math notranslate nohighlight">\(\Gamma\)</span>), and <span class="math notranslate nohighlight">\(\forall q\)</span>:</p>
<div class="math notranslate nohighlight">
\[\int_\Omega  ((\mathbf{u}\cdot\nabla) \mathbf{u} ). \mathbf{v} + \nu \nabla \mathbf{u}:\nabla \mathbf{v}
- p \nabla\cdot \mathbf{v} - q \nabla\cdot \mathbf{u} = 0\]</div>
<p>The Newton Algorithm to solve nonlinear problem is:</p>
<p>Find <span class="math notranslate nohighlight">\(u\in V\)</span> such that <span class="math notranslate nohighlight">\(F(u)=0\)</span> where <span class="math notranslate nohighlight">\(F : V \mapsto V\)</span>.</p>
<ol class="arabic simple">
<li>choose <span class="math notranslate nohighlight">\(u_0\in \mathbb{R}^n\)</span> , ;</li>
<li>for ( <span class="math notranslate nohighlight">\(i =0\)</span>; <span class="math notranslate nohighlight">\(i\)</span> &lt; niter; <span class="math notranslate nohighlight">\(i = i+1\)</span>)<ol class="arabic">
<li>solve <span class="math notranslate nohighlight">\(DF(u_i) w_i = F(u_i)\)</span>;</li>
<li><span class="math notranslate nohighlight">\(u_{i+1} = u_i - w_i\)</span>;</li>
</ol>
</li>
</ol>
<p>break <span class="math notranslate nohighlight">\(|| w_i|| &lt; \varepsilon\)</span>.</p>
<p>Where <span class="math notranslate nohighlight">\(DF(u)\)</span> is the differential of <span class="math notranslate nohighlight">\(F\)</span> at point <span class="math notranslate nohighlight">\(u\)</span>, this is a linear application such that:</p>
<div class="math notranslate nohighlight">
\[F(u+\delta) = F(u) + DF(u) \delta + o(\delta)\]</div>
<p>For Navier Stokes, <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(DF\)</span> are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    F(\mathbf{u},p) &amp;=&amp; \int_\Omega((\mathbf{u}\cdot\nabla) \mathbf{u} ). \mathbf{v} + \nu \nabla \mathbf{u}:\nabla \mathbf{v}
    - p \nabla\cdot \mathbf{v} - q \nabla\cdot \mathbf{u}\\
    DF(\mathbf{u},p)(\mathbf{\delta u} ,\delta p) &amp;=&amp; \int_\Omega ((\mathbf{\delta u}\cdot\nabla) \mathbf{u} ). \mathbf v + ((\mathbf{u}\cdot\nabla) \mathbf{\delta u} ). \mathbf{v} \\
    &amp;+&amp; \nu \nabla \mathbf{\delta u}:\nabla \mathbf{v} - \delta p \nabla\cdot \mathbf{v} - q \nabla\cdot \mathbf{\delta u}
\end{array}\end{split}\]</div>
<p>So the Newton algorithm become:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">R</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">L</span> <span class="o">=</span> <span class="mf">15.</span><span class="p">;</span>

<span class="kt">real</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">nufinal</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">200.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">cnu</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>

<span class="kt">real</span> <span class="kp">eps</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">;</span>

<span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">cc</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">ce</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="kr">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="kr">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">beb</span><span class="p">(</span><span class="n">tt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kt">real</span> <span class="kp">t</span><span class="o">=</span><span class="n">tt</span><span class="o">^</span><span class="mf">1.2</span><span class="p">;</span> <span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="o">*</span><span class="n">L</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">R</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">beu</span><span class="p">(</span><span class="n">tt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kt">real</span> <span class="kp">t</span><span class="o">=</span><span class="n">tt</span><span class="o">^</span><span class="mf">1.2</span><span class="p">;</span> <span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="o">*</span><span class="n">L</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">R</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">beo</span><span class="p">(</span><span class="kp">t</span><span class="o">=-</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">L</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">bei</span><span class="p">(</span><span class="kp">t</span><span class="o">=-</span><span class="n">R</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">R</span><span class="o">/</span><span class="mi">4</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">cc</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="n">ce</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="n">beb</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">beu</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">beo</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">bei</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">);</span>

<span class="c1">//bounding box for the plot</span>
<span class="kt">func</span> <span class="kp">bb</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">du1</span><span class="p">,</span><span class="n">du2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">u1p</span><span class="p">,</span><span class="n">u2p</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="nc">P1</span><span class="p">);</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">q</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">dp</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">pp</span><span class="p">;</span>

<span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="nf">Grad</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">),</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">),</span><span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)]</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">UgradV</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span> <span class="p">[[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">]</span><span class="o">&#39;*</span><span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">),</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">)],</span>
                        <span class="p">[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">]</span><span class="o">&#39;*</span><span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">v2</span><span class="p">),</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)]]</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">div</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">)</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span> <span class="c1">//</span>

<span class="c1">// Initialization</span>
<span class="n">u1</span> <span class="o">=</span> <span class="p">(</span><span class="kr">x</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="kr">y</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">u2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Viscosity loop</span>
<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
    <span class="kt">int</span> <span class="kr">n</span><span class="p">;</span>
    <span class="kt">real</span> <span class="kp">err</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="c1">// Newton loop</span>
    <span class="k">for</span> <span class="p">(</span><span class="kr">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="kr">n</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">;</span> <span class="kr">n</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">// Newton</span>
        <span class="kt">solve</span> <span class="n">Oseen</span> <span class="p">([</span><span class="n">du1</span><span class="p">,</span> <span class="n">du2</span><span class="p">,</span> <span class="n">dp</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
            <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
                    <span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">Grad</span><span class="p">(</span><span class="n">du1</span><span class="p">,</span><span class="n">du2</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">Grad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">UgradV</span><span class="p">(</span><span class="n">du1</span><span class="p">,</span><span class="n">du2</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">UgradV</span><span class="p">(</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span><span class="n">du1</span><span class="p">,</span><span class="n">du2</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">div</span><span class="p">(</span><span class="n">du1</span><span class="p">,</span><span class="n">du2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span>
                <span class="o">-</span> <span class="n">div</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dp</span>
                <span class="o">-</span> <span class="mf">1e-8</span><span class="o">*</span><span class="n">dp</span><span class="o">*</span><span class="n">q</span> <span class="c1">//stabilization term</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span> <span class="p">(</span>
                    <span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">Grad</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">Grad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">UgradV</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">div</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span>
                <span class="o">-</span> <span class="n">div</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">du1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">du2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">;</span>

        <span class="n">u1</span><span class="p">[]</span> <span class="o">-=</span> <span class="n">du1</span><span class="p">[];</span>
        <span class="n">u2</span><span class="p">[]</span> <span class="o">-=</span> <span class="n">du2</span><span class="p">[];</span>
        <span class="n">p</span><span class="p">[]</span> <span class="o">-=</span> <span class="n">dp</span><span class="p">[];</span>

        <span class="kt">real</span> <span class="n">Lu1</span><span class="o">=</span><span class="n">u1</span><span class="p">[].</span><span class="kr">linfty</span><span class="p">,</span> <span class="n">Lu2</span><span class="o">=</span><span class="n">u2</span><span class="p">[].</span><span class="kr">linfty</span><span class="p">,</span> <span class="n">Lp</span><span class="o">=</span><span class="n">p</span><span class="p">[].</span><span class="kr">linfty</span><span class="p">;</span>
        <span class="kp">err</span> <span class="o">=</span> <span class="n">du1</span><span class="p">[].</span><span class="kr">linfty</span><span class="o">/</span><span class="n">Lu1</span> <span class="o">+</span> <span class="n">du2</span><span class="p">[].</span><span class="kr">linfty</span><span class="o">/</span><span class="n">Lu2</span> <span class="o">+</span> <span class="n">dp</span><span class="p">[].</span><span class="kr">linfty</span><span class="o">/</span><span class="n">Lp</span><span class="p">;</span>

        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">n</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; err = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">err</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">eps</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; rey = &quot;</span> <span class="o">&lt;&lt;</span> <span class="mf">1.</span><span class="o">/</span><span class="n">nu</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="kp">err</span> <span class="o">&lt;</span> <span class="kp">eps</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//converge</span>
        <span class="k">if</span><span class="p">(</span> <span class="kr">n</span><span class="o">&gt;</span><span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="kp">err</span> <span class="o">&gt;</span> <span class="mf">10.</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//blowup</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="kp">err</span> <span class="o">&lt;</span> <span class="kp">eps</span><span class="p">){</span>  <span class="c1">//converge: decrease $\nu$ (more difficult)</span>
        <span class="c1">// Plot</span>
        <span class="nf">plot</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; rey = &quot;</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="n">nu</span> <span class="p">,</span> <span class="kp">coef</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="kp">bb</span><span class="o">=</span><span class="kp">bb</span><span class="p">);</span>

        <span class="c1">// Change nu</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">nu</span> <span class="o">==</span> <span class="n">nufinal</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="kr">n</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="n">cnu</span> <span class="o">=</span> <span class="n">cnu</span><span class="o">^</span><span class="mf">1.5</span><span class="p">;</span> <span class="c1">//fast converge =&gt; change faster</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="kr">max</span><span class="p">(</span><span class="n">nufinal</span><span class="p">,</span> <span class="n">nu</span><span class="o">*</span> <span class="n">cnu</span><span class="p">);</span> <span class="c1">//new viscosity</span>

        <span class="c1">// Update</span>
        <span class="n">u1p</span> <span class="o">=</span> <span class="n">u1</span><span class="p">;</span>
        <span class="n">u2p</span> <span class="o">=</span> <span class="n">u2</span><span class="p">;</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>   <span class="c1">//blowup: increase $\nu$ (more simple)</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">cnu</span><span class="o">&lt;</span> <span class="mf">0.95</span><span class="p">);</span> <span class="c1">//the method finally blowup</span>

        <span class="c1">// Recover nu</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span><span class="o">/</span><span class="n">cnu</span><span class="p">;</span>
        <span class="n">cnu</span><span class="o">=</span> <span class="n">cnu</span><span class="o">^</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">1.5</span><span class="p">);</span> <span class="c1">//no conv. =&gt; change lower</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span><span class="o">*</span> <span class="n">cnu</span><span class="p">;</span> <span class="c1">//new viscosity</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; restart nu = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nu</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Rey = &quot;</span> <span class="o">&lt;&lt;</span> <span class="mf">1.</span><span class="o">/</span><span class="n">nu</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; (cnu = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">cnu</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ) </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

        <span class="c1">// Recover a correct solution</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">u1p</span><span class="p">;</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">u2p</span><span class="p">;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pp</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>We use a trick to make continuation on the viscosity <span class="math notranslate nohighlight">\(\nu\)</span>, because the Newton method blowup owe start with the final viscosity <span class="math notranslate nohighlight">\(\nu\)</span>.</p>
<p class="last"><span class="math notranslate nohighlight">\(\nu\)</span> is gradually increased to the desired value.</p>
</div>
<div class="inline2 figure" id="id1">
<img alt="../_images/NSNewtonTh.jpg" src="../_images/NSNewtonTh.jpg" />
<p class="caption"><span class="caption-number">Fig. 100 </span><span class="caption-text">Mesh</span></p>
</div>
<div class="inline2 figure" id="id2">
<img alt="../_images/NSNewtonUP.jpg" src="../_images/NSNewtonUP.jpg" />
<p class="caption"><span class="caption-number">Fig. 101 </span><span class="caption-text">Velocity and pressure at Reynolds 200</span></p>
</div>
</div>


				</div>
			</div>
		</div>
		
		<footer>
			<script>
    let date = new Date()
    let currentYear = date.getFullYear()
</script>
<div class="footer-text">
    <a href="https://freefem.org/">FreeFem++</a> 1987-<script>document.write(currentYear)</script>
</div>
<div class="footer-img">
    <p>
        Made with <i class="fas fa-heart"></i> on
    </p>
    <span class="separator"></span>
    <a href="https://github.com/FreeFem">
        <img alt="Github" title="Github" src="../_static/img/GitHub_Logo_White.png" />
    </a>
</div>
		</footer>
		

		<script src="../_static/js/toc.js"></script>
	</body>
</html>