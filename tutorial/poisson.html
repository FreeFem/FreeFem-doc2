<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Solving Poisson’s equation</title>
		<link rel="icon" href="../_static/img/favicon.png">

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

		<!-- FreeFem++ theme specific -->
		<link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

		<!-- css -->
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

		<!-- js -->
		<script src="../_static/nav.json"></script>
		<script src="../_static/js/nav.js"></script>
		<script src="../_static/js/common.js"></script>

		<!-- MathJax -->
		<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
			<div class="header-logo">
    <div>
        <a href="../introduction/introduction.html">
            <img alt="logo" title="FreeFem++ documentation" src="../_static/img/Logo.png" />
        </a>
    </div>
</div>
<div class="header-title">
    <div>
        <a href="../introduction/introduction.html">
            <h2>FreeFem++ documentation</h2>
        </a>
    </div>
</div>
<div class="header-github">
    <a href="https://github.com/FreeFem/FreeFem-sources">
        <div class="header-github-img">
            <img alt="GitHub" title="FreeFem++ on GitHub" src="../_static/img/GitHub-Mark-120px-plus.png" />
        </div>
        <div class="header-github-title">
            <div class="header-github-title-text">
                FreeFem++ on GitHub
            </div>
            <div class="header-github-title-stars">
                <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
            </div>
        </div>
    </a>
</div>
<script src="../_static/js/github.js"></script>
		</header>
		
		<nav>
			<script>nav("../")</script>
			<div class="search">
				<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr_index.js"></script>

<script src="../_static/js/search.js"></script>

<div class="search">
    <input type="search" id="searchInput" placeholder="Search..." oninput="search(this.value);" />
    <div class="searchResults">
        <div id="resultCount">
        </div>
        <div id="searchResults">
        </div>
    </div>
</div>
			</div>
		</nav>
		

		
		<div class="container">
			<div class="toc" id="toc">
				<div>
					<ul>
<li><a class="reference internal" href="#">Solving Poisson’s equation</a></li>
</ul>

				</div>
			</div>
			<div class="content">
				<div>
					
    <div class="section" id="solving-poisson-s-equation">
<span id="tutorialpoisson"></span><h1>Solving Poisson’s equation<a class="headerlink" href="#solving-poisson-s-equation" title="Permalink to this headline">¶</a></h1>
<p>For a given function <span class="math notranslate nohighlight">\(f(x,y)\)</span>, find a function <span class="math notranslate nohighlight">\(u(x,y)\)</span> satisfying :</p>
<div class="math notranslate nohighlight" id="equation-eqn-poisson">
<span class="eqno">(37)<a class="headerlink" href="#equation-eqn-poisson" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{array}{rcl}
    -\Delta u(x,y) &amp;= f(x,y) &amp; \mbox{ for all }(x,y)\mbox{ in }\Omega\\
    u(x,y) &amp;= 0 &amp; \mbox{ for all }(x,y)\mbox{ on }\partial\Omega
\end{array}\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\partial\Omega\)</span> is the boundary of the bounded open set <span class="math notranslate nohighlight">\(\Omega\subset\mathbb{R}^2\)</span> and <span class="math notranslate nohighlight">\(\Delta u = \frac{\partial^2 u}{\partial x^2 } + \frac{\partial^2 u}{\partial y^2}\)</span>.</p>
<p>We will compute <span class="math notranslate nohighlight">\(u\)</span> with <span class="math notranslate nohighlight">\(f(x,y)=xy\)</span> and <span class="math notranslate nohighlight">\(\Omega\)</span> the unit disk. The boundary <span class="math notranslate nohighlight">\(C=\partial\Omega\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[C=\{(x,y)|\; x=\cos(t),\, y=\sin(t),\, 0\le t\le 2\pi\}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <strong>FreeFem++</strong>, the domain <span class="math notranslate nohighlight">\(\Omega\)</span> is assumed to be described by the left side of its boundary.</p>
</div>
<p>The following is the <strong>FreeFem++</strong> program which computes <span class="math notranslate nohighlight">\(u\)</span>:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define mesh boundary</span>
<span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>

<span class="c1">// The triangulated domain Th is on the left side of its boundary</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">50</span><span class="p">));</span>

<span class="c1">// The finite element space defined over Th is called here Vh</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span><span class="c1">// Define u and v as piecewise-P1 continuous functions</span>

<span class="c1">// Define a function f</span>
<span class="kt">func</span> <span class="n">f</span><span class="o">=</span> <span class="kr">x</span><span class="o">*</span><span class="kr">y</span><span class="p">;</span>

<span class="c1">// Get the clock in second</span>
<span class="kt">real</span> <span class="n">cpu</span><span class="o">=</span><span class="nf">clock</span><span class="p">();</span>

<span class="c1">// Define the PDE</span>
<span class="kt">solve</span> <span class="nf">Poisson</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">LU</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>    <span class="c1">// The bilinear part</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>    <span class="c1">// The right hand side</span>
          <span class="n">f</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>   <span class="c1">// The Dirichlet boundary condition</span>

<span class="c1">// Plot the result</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>

<span class="c1">// Display the total computational time</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;CPU time = &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="nf">clock</span><span class="p">()</span><span class="o">-</span><span class="n">cpu</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>As illustrated in <a class="reference internal" href="#figpoissonu"><span class="std std-numref">Fig. 78</span></a>, we can see the isovalue of <span class="math notranslate nohighlight">\(u\)</span> by using <strong>FreeFem++</strong> <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">plot</span></code> command (see line 29 above).</p>
<div class="inline2 figure" id="figpoissonmesh">
<img alt="../_images/firstTh.png" src="../_images/firstTh.png" />
<p class="caption"><span class="caption-number">Fig. 77 </span><span class="caption-text">Mesh Th by <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span></code></span></p>
</div>
<div class="inline2 figure" id="figpoissonu">
<img alt="../_images/firstU.png" src="../_images/firstU.png" />
<p class="caption"><span class="caption-number">Fig. 78 </span><span class="caption-text">Isovalue by <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The qualifier <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">solver</span><span class="o">=</span><span class="kr">LU</span></code> (line 18) is not required and by default a multi-frontal <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kr">LU</span></code> is used.</p>
<p class="last">The lines containing <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">clock</span></code> are equally not required.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Note how close to the mathematics <strong>FreeFem++</strong> language is.</p>
<p>Lines 19 to 24 correspond to the mathematical variational equation:</p>
<div class="math notranslate nohighlight">
\[\int_{T_h}
(
   \frac{\partial u}{\partial x}\frac{\partial v}{\partial x}
   + \frac{\partial u}{\partial y}\frac{\partial v}{\partial y}
)\text{d} x \text{d} y
= \int_{T_h}f v\text{d} x\text{d} y\]</div>
<p class="last">for all <span class="math notranslate nohighlight">\(v\)</span> which are in the finite element space <span class="math notranslate nohighlight">\(V_h\)</span> and zero on the boundary <span class="math notranslate nohighlight">\(C\)</span>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Change <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nc">P1</span></code> into <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nc">P2</span></code> and run the program.</p>
</div>
<p>This first example shows how <strong>FreeFem++</strong> executes with no effort all the usual steps required by the finite element method (FEM).
Let’s go through them one by one.</p>
<p><strong>On the line 2</strong>:</p>
<p>The boundary <span class="math notranslate nohighlight">\(\Gamma\)</span> is described analytically by a parametric equation for <span class="math notranslate nohighlight">\(x\)</span> and for <span class="math notranslate nohighlight">\(y\)</span>.
When <span class="math notranslate nohighlight">\(\Gamma=\sum_{j=0}^J \Gamma_j\)</span> then each curve <span class="math notranslate nohighlight">\(\Gamma_j\)</span> must be specified and crossings of <span class="math notranslate nohighlight">\(\Gamma_j\)</span> are not allowed except at end points.</p>
<p>The keyword <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kr">label</span></code> can be added to define a group of boundaries for later use (boundary conditions for instance).
Hence the circle could also have been described as two half circle with the same label:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">border</span> <span class="nf">Gamma1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="n">C</span><span class="p">};</span>
<span class="kt">border</span> <span class="nf">Gamma2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="kr">pi</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="n">C</span><span class="p">};</span>
</pre></div>
</div>
<p>Boundaries can be referred to either by name (<code class="docutils literal highlight highlight-default"><span></span><span class="n">Gamma1</span></code> for example) or by label (<code class="docutils literal highlight highlight-default"><span></span><span class="n">C</span></code> here) or even by its internal number here 1 for the first half circle and 2 for the second (more examples are in <a class="reference internal" href="../example/index.html#examplemeshgeneration"><span class="std std-ref">Meshing Examples</span></a>).</p>
<p><strong>On the line 5</strong></p>
<p>The triangulation <span class="math notranslate nohighlight">\(\mathcal{T}_h\)</span> of <span class="math notranslate nohighlight">\(\Omega\)</span> is automatically generated by <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span></code> using 50 points on <code class="docutils literal highlight highlight-default"><span></span><span class="n">C</span></code> as in <a class="reference internal" href="#figpoissonmesh"><span class="std std-numref">Fig. 77</span></a>.</p>
<p>The domain is assumed to be on the left side of the boundary which is implicitly oriented by the parametrization. So an elliptic hole can be added by typing:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="kr">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.1</span><span class="o">+</span><span class="mf">0.3</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);};</span>
</pre></div>
</div>
<p>If by mistake one had written:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.1</span><span class="o">+</span><span class="mf">0.3</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);};</span>
</pre></div>
</div>
<p>then the inside of the ellipse would be triangulated as well as the outside.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Automatic mesh generation is based on the Delaunay-Voronoi algorithm.
Refinement of the mesh are done by increasing the number of points on <span class="math notranslate nohighlight">\(\Gamma\)</span>, for example <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span></code>, because inner vertices are determined by the density of points on the boundary.</p>
<p class="last">Mesh adaptation can be performed also against a given function <cite>f</cite> by calling <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">f</span><span class="p">)</span></code>.</p>
</div>
<p>Now the name <span class="math notranslate nohighlight">\(\mathcal{T}_h\)</span> (<code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="n">Th</span></code> in <strong>FreeFem++</strong>) refers to the family <span class="math notranslate nohighlight">\(\{T_k\}_{k=1,\cdots,n_t}\)</span> of triangles shown in <a class="reference internal" href="#figpoissonmesh"><span class="std std-numref">Fig. 77</span></a>.</p>
<p>Traditionally <span class="math notranslate nohighlight">\(h\)</span> refers to the mesh size, <span class="math notranslate nohighlight">\(n_t\)</span> to the number of triangles in <span class="math notranslate nohighlight">\(\mathcal{T}_h\)</span> and <span class="math notranslate nohighlight">\(n_v\)</span> to the number of vertices, but it is seldom that we will have to use them explicitly.</p>
<p>If <span class="math notranslate nohighlight">\(\Omega\)</span> is not a polygonal domain, a “skin” remains between the exact domain <span class="math notranslate nohighlight">\(\Omega\)</span> and its approximation <span class="math notranslate nohighlight">\(\Omega_h=\cup_{k=1}^{n_t}T_k\)</span>.
However, we notice that all corners of <span class="math notranslate nohighlight">\(\Gamma_h = \partial\Omega_h\)</span> are on <span class="math notranslate nohighlight">\(\Gamma\)</span>.</p>
<p><strong>On line 8:</strong></p>
<p>A finite element space is, usually, a space of polynomial functions on elements, triangles here only, with certain matching properties at edges, vertices etc. Here <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kt">fespace</span> <span class="n">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">)</span></code> defines <span class="math notranslate nohighlight">\(V_h\)</span> to be the space of continuous functions which are affine in <span class="math notranslate nohighlight">\(x,y\)</span> on each triangle of <span class="math notranslate nohighlight">\(T_h\)</span>.</p>
<p>As it is a linear vector space of finite dimension, basis can be found.
The canonical basis is made of functions, called the <em>hat function</em> <span class="math notranslate nohighlight">\(\phi_k\)</span> which are continuous piecewise affine and are equal to 1 on one vertex and 0 on all others. A typical hat function is shown on <a class="reference internal" href="#figpoissonhat"><span class="std std-numref">Fig. 80</span></a>.</p>
<div class="inline2 figure" id="figpoissonmesh2">
<img alt="../_images/meshTh_2.png" src="../_images/meshTh_2.png" />
<p class="caption"><span class="caption-number">Fig. 79 </span><span class="caption-text"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kt">mesh</span> <span class="n">Th</span></code></span></p>
</div>
<div class="inline2 figure" id="figpoissonhat">
<img alt="../_images/hat_functions.png" src="../_images/hat_functions.png" />
<p class="caption"><span class="caption-number">Fig. 80 </span><span class="caption-text">Graph of <span class="math notranslate nohighlight">\(\phi_1\)</span> (left) and <span class="math notranslate nohighlight">\(\phi_6\)</span> (right)</span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The easiest way to define <span class="math notranslate nohighlight">\(\phi_k\)</span> is by making use of the <em>barycentric coordinates</em> <span class="math notranslate nohighlight">\(\lambda_i(x,y),~i=1,2,3\)</span> of a point <span class="math notranslate nohighlight">\(q=(x,y)\in T\)</span>, defined by <span class="math notranslate nohighlight">\(\sum_i\lambda_i=1,~~~\sum_i\lambda_i\vec q^i=\vec q\)</span> where <span class="math notranslate nohighlight">\(q^i,~i=1,2,3\)</span> are the 3 vertices of <span class="math notranslate nohighlight">\(T\)</span>.
Then it is easy to see that the restriction of <span class="math notranslate nohighlight">\(\phi_k\)</span> on <span class="math notranslate nohighlight">\(T\)</span> is precisely <span class="math notranslate nohighlight">\(\lambda_k\)</span>.</p>
</div>
<p>Then:</p>
<div class="math notranslate nohighlight" id="equation-equation3">
<span class="eqno">(38)<a class="headerlink" href="#equation-equation3" title="Permalink to this equation">¶</a></span>\[V_h(\mathcal{T}_h,P_1)=\left\{w(x,y)\left|\; w(x,y)=\sum_{k=1}^{M}w_k\phi_k(x,y),\, w_k\textrm{ are real numbers}\right.\right\}\]</div>
<p>where <span class="math notranslate nohighlight">\(M\)</span> is the dimension of <span class="math notranslate nohighlight">\(V_h\)</span>, i.e.&nbsp;the number of vertices.
The <span class="math notranslate nohighlight">\(w_k\)</span> are called the <em>degree of freedom</em> of <span class="math notranslate nohighlight">\(w\)</span> and <span class="math notranslate nohighlight">\(M\)</span> the number of degree of freedom.</p>
<p>It is said also that the <em>nodes</em> of this finite element method are the vertices.</p>
<p><strong>Setting the problem</strong></p>
<p>On line 9, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span></code> declares that <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span> are approximated as above, namely:</p>
<div class="math notranslate nohighlight" id="equation-defu">
<span class="eqno">(39)<a class="headerlink" href="#equation-defu" title="Permalink to this equation">¶</a></span>\[u(x,y)\simeq u_h(x,y)=\sum_{k=0}^{M-1} u_k\phi_k(x,y)\]</div>
<p>On the line 12, the right hand side <code class="docutils literal highlight highlight-default"><span></span><span class="n">f</span></code> is defined analytically using the keyword <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kt">func</span></code>.</p>
<p>Line 18 to 26 define the bilinear form of equation <a class="reference internal" href="#equation-eqn-poisson">(37)</a> and its Dirichlet boundary conditions.</p>
<p>This <em>variational formulation</em> is derived by multiplying <a class="reference internal" href="#equation-eqn-poisson">(37)</a> by <span class="math notranslate nohighlight">\(v(x,y)\)</span> and integrating the result over <span class="math notranslate nohighlight">\(\Omega\)</span>:</p>
<div class="math notranslate nohighlight">
\[-\int_{\Omega}v\Delta u \,\text{d} x\text{d} y = \int_{\Omega} vf\, \text{d} x\text{d} y\]</div>
<p>Then, by Green’s formula, the problem is converted into finding <span class="math notranslate nohighlight">\(u\)</span> such that</p>
<div class="math notranslate nohighlight">
\[a(u,v) - \ell(f,v) = 0 \quad \forall v \mbox{ satisfying }v=0\mbox{ on }\partial\Omega.\]</div>
<p>with:</p>
<div class="math notranslate nohighlight" id="equation-eqn-weakform">
<span class="eqno">(40)<a class="headerlink" href="#equation-eqn-weakform" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{array}{rcl}
    a(u,v) &amp;=&amp; \int_{\Omega}\nabla u\cdot \nabla v \,\text{d} x\text{d} y\\
    \ell(f,v) &amp;=&amp; \int_{\Omega}fv\, \text{d} x\text{d} y
\end{array}\end{split}\]</div>
<p>In <strong>FreeFem++</strong> the <strong>Poisson</strong> problem can be declared only as in:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="n">Vh</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">;</span> <span class="kt">problem</span> <span class="n">Poisson</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="p">...</span>
</pre></div>
</div>
<p>and solved later as in:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="n">Poisson</span><span class="p">;</span> <span class="c1">//the problem is solved here</span>
</pre></div>
</div>
<p>or declared and solved at the same time as in:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="n">Vh</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">;</span> <span class="kt">solve</span> <span class="n">Poisson</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="p">...</span>
</pre></div>
</div>
<p>and <a class="reference internal" href="#equation-eqn-weakform">(40)</a> is written with <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code> <span class="math notranslate nohighlight">\(=\partial u/\partial x\)</span>, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code> <span class="math notranslate nohighlight">\(=\partial u/\partial y\)</span> and:</p>
<p><span class="math notranslate nohighlight">\(\displaystyle{\int_{\Omega}\nabla u\cdot \nabla v\, \text{d} x\text{d} y \longrightarrow}\)</span>
<code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span></code></p>
<p><span class="math notranslate nohighlight">\(\displaystyle{\int_{\Omega}fv\, \text{d} x\text{d} y \longrightarrow}\)</span>
<code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span> <span class="n">f</span><span class="o">*</span><span class="n">v</span> <span class="p">)</span></code> (Notice here, <span class="math notranslate nohighlight">\(u\)</span> is unused)</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In <strong>FreeFem++</strong> <strong>bilinear terms and linear terms should not be under the same integral</strong> indeed to construct the linear systems <strong>FreeFem++</strong> finds out which integral contributes to the bilinear form by checking if both terms, the unknown (here <code class="docutils literal highlight highlight-default"><span></span><span class="n">u</span></code>) and test functions (here <code class="docutils literal highlight highlight-default"><span></span><span class="n">v</span></code>) are present.</p>
</div>
<p><strong>Solution and visualization</strong></p>
<p>On line 15, the current time in seconds is stored into the real-valued variable <code class="docutils literal highlight highlight-default"><span></span><span class="n">cpu</span></code>.</p>
<p>Line 18, the problem is solved.</p>
<p>Line 29, the visualization is done as illustrated in <a class="reference internal" href="#figpoissonu"><span class="std std-numref">Fig. 78</span></a>.</p>
<p><strong>(see</strong> <a class="reference internal" href="../documentation/visualization.html#plot"><span class="std std-ref">Plot</span></a> <strong>for zoom, postscript and other commands).</strong></p>
<p>Line 32, the computing time (not counting graphics) is written on the console. Notice the C++-like syntax; the user needs not study C++ for using <strong>FreeFem++</strong>, but it helps to guess what is allowed in the language.</p>
<p><strong>Access to matrices and vectors</strong></p>
<p>Internally <strong>FreeFem++</strong> will solve a linear system of the type</p>
<div class="math notranslate nohighlight" id="equation-eqn-equation">
<span class="eqno">(41)<a class="headerlink" href="#equation-eqn-equation" title="Permalink to this equation">¶</a></span>\[\sum_{j=0}^{M-1} A_{ij}u_j - F_i=0 ,\quad i=0,\cdots,M-1;\qquad
F_i=\int_{\Omega}f\phi_i\, \text{d} x\text{d} y\]</div>
<p>which is found by using <a class="reference internal" href="#equation-defu">(39)</a> and replacing <span class="math notranslate nohighlight">\(v\)</span> by <span class="math notranslate nohighlight">\(\phi_i\)</span> in <a class="reference internal" href="#equation-eqn-weakform">(40)</a>.
The Dirichlet conditions are implemented by penalty, namely by setting <span class="math notranslate nohighlight">\(A_{ii}=10^{30}\)</span> and <span class="math notranslate nohighlight">\(F_i=10^{30}*0\)</span> if <span class="math notranslate nohighlight">\(i\)</span> is a boundary degree of freedom.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The number <span class="math notranslate nohighlight">\(10^{30}\)</span> is called <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">tgv</span></code> (<em>très grande valeur</em> or <em>very high value</em> in english) and it is generally possible to change this value, see the item :freefem`solve, tgv=`</p>
</div>
<p>The matrix <span class="math notranslate nohighlight">\(A=(A_{ij})\)</span> is called <em>stiffness matrix</em>.
If the user wants to access <span class="math notranslate nohighlight">\(A\)</span> directly he can do so by using (see section <a class="reference internal" href="../documentation/finiteElement.html#variationalformsparsematrixpde"><span class="std std-ref">Variational form, Sparse matrix, PDE data vector</span></a> for details).</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">varf</span> <span class="nf">a</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>
<span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">Vh</span><span class="p">,</span> <span class="n">Vh</span><span class="p">);</span> <span class="c1">//stiffness matrix</span>
</pre></div>
</div>
<p>The vector <span class="math notranslate nohighlight">\(F\)</span> in <a class="reference internal" href="#equation-eqn-equation">(41)</a> can also be constructed manually:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">varf</span> <span class="nf">l</span><span class="p">(</span><span class="kr">unused</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">f</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="kr">unused</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>
<span class="n">Vh</span> <span class="n">F</span><span class="p">;</span>
<span class="n">F</span><span class="p">[]</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Vh</span><span class="p">);</span> <span class="c1">//F[] is the vector associated to the function F</span>
</pre></div>
</div>
<p>The problem can then be solved by:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="n">u</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">F</span><span class="p">[];</span> <span class="c1">//u[] is the vector associated to the function u</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Here <code class="docutils literal highlight highlight-default"><span></span><span class="n">u</span></code> and <code class="docutils literal highlight highlight-default"><span></span><span class="n">F</span></code> are finite element function, and <code class="docutils literal highlight highlight-default"><span></span><span class="n">u</span><span class="p">[]</span></code> and <code class="docutils literal highlight highlight-default"><span></span><span class="n">F</span><span class="p">[]</span></code> give the array of value associated (<code class="docutils literal highlight highlight-default"><span></span><span class="n">u</span><span class="p">[]</span></code> <span class="math notranslate nohighlight">\(\equiv (u_i)_{i=0,\dots,M-1}\)</span> and <code class="docutils literal highlight highlight-default"><span></span><span class="n">F</span><span class="p">[]</span></code> <span class="math notranslate nohighlight">\(\equiv (F_i)_{i=0,\dots,M-1}\)</span>).</p>
<p>So we have:</p>
<div class="math notranslate nohighlight">
\[\mathtt{u}(x,y) = \sum_{i=0}^{M-1} \mathtt{u[][}i\mathtt{]} \phi_i(x,y) ,
\qquad \mathtt{F}(x,y) = \sum_{i=0}^{M-1} \mathtt{F[][}i\mathtt{]} \phi_i(x,y)\]</div>
<p class="last">where <span class="math notranslate nohighlight">\(\phi_i, i=0...,,M-1\)</span> are the basis functions of <cite>Vh</cite> like in equation (ref{equation3}), and <span class="math notranslate nohighlight">\(M = \mathtt{Vh.ndof}\)</span> is the number of degree of freedom (i.e. the dimension of the space <cite>Vh</cite>).</p>
</div>
<p>The linear system <a class="reference internal" href="#equation-eqn-equation">(41)</a> is solved by <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kr">UMFPACK</span></code> unless another option is mentioned specifically as in:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
<span class="kt">problem</span> <span class="n">Poisson</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(...</span>
</pre></div>
</div>
<p>meaning that <code class="docutils literal highlight highlight-default"><span></span><span class="n">Poisson</span></code> is declared only here and when it is called (by simply writing <code class="docutils literal highlight highlight-default"><span></span><span class="n">Poisson</span><span class="p">;</span></code>) then <a class="reference internal" href="#equation-eqn-equation">(41)</a> will be solved by the Conjugate Gradient method.</p>
</div>


				</div>
			</div>
		</div>
		
		<footer>
			<script>
    let date = new Date()
    let currentYear = date.getFullYear()
</script>
<div class="footer-text">
    <a href="https://freefem.org/">FreeFem++</a> 1987-<script>document.write(currentYear)</script>
</div>
<div class="footer-img">
    <p>
        Made with <i class="fas fa-heart"></i> on
    </p>
    <span class="separator"></span>
    <a href="https://github.com/FreeFem">
        <img alt="Github" title="Github" src="../_static/img/GitHub_Logo_White.png" />
    </a>
</div>
		</footer>
		

		<script src="../_static/js/toc.js"></script>
	</body>
</html>