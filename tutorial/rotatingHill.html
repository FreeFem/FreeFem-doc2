<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>Pure Convection : The Rotating Hill &#8212; FreeFem++ 3.61.2 documentation</title>

    <link rel="stylesheet" href="../_static/material-icons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/notosanscjkjp.css" />
    <link rel="stylesheet" type="text/css" href="../_static/roboto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material-design-lite-1.3.0/material.indigo-pink.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_materialdesign_theme.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sphinx_materialdesign_theme.js"></script>
    <link rel="canonical" href="doc.freefem.org/dev/tutorial/rotatingHill.html" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The System of elasticity" href="elasticity.html" />
    <link rel="prev" title="Irrotational Fan Blade Flow and Thermal effects" href="fanBlade.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link" href="index.html">Tutorials</a><i class="material-icons">navigate_next</i>
            <a class="mdl-navigation__link is-active">Pure Convection : The Rotating Hill</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="../search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
<a id="button-show-source"
    class="mdl-button mdl-js-button mdl-button--icon"
    href="../_sources/tutorial/rotatingHill.rst.txt" rel="nofollow">
<i class="material-icons">code</i>
</a>
<div class="mdl-tooltip" data-mdl-for="button-show-source">
Show Source
</div>
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="aLargeFluidProblem.html">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Mathematical Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../model/model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/evolutionProblems.html">Evolution problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/navierStokesEquations.html">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="aLargeFluidProblem.html">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Mathematical Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../model/model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/evolutionProblems.html">Evolution problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/navierStokesEquations.html">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <div class="section" id="pure-convection-the-rotating-hill">
<h1>Pure Convection : The Rotating Hill<a class="headerlink" href="#pure-convection-the-rotating-hill" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2><strong>Summary:</strong><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p><em>Here we will present two methods for upwinding for the simplest convection problem.
We will learn about Characteristics-Galerkin and Discontinuous-Galerkin Finite Element Methods.</em></p>
<p>Let <span class="math notranslate nohighlight">\(\Omega\)</span> be the unit disk centered at <span class="math notranslate nohighlight">\((0,0)\)</span>; consider the rotation vector field</p>
<div class="math notranslate nohighlight">
\[\mathbf{u} = [u1,u2], \qquad u_1 = y,\quad u_2 = -x\]</div>
<p>Pure convection by <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\partial_t c + \mathbf{u}.\nabla c &amp;= 0 &amp;\hbox{ in } \Omega\times(0,T)\\
c (t=0) &amp;= c ^0 &amp;\hbox{ in } \Omega.\end{split}\]</div>
<p>The exact solution <span class="math notranslate nohighlight">\(c(x_t,t)\)</span> at time <span class="math notranslate nohighlight">\(t\)</span> en point <span class="math notranslate nohighlight">\(x_t\)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[c(x_t,t)=c^0(x,0)\]</div>
<p>where <span class="math notranslate nohighlight">\(x_t\)</span> is the particle path in the flow starting at point <span class="math notranslate nohighlight">\(x\)</span> at time <span class="math notranslate nohighlight">\(0\)</span>. So <span class="math notranslate nohighlight">\(x_t\)</span> are solutions of</p>
<div class="math notranslate nohighlight">
\[\dot{x_t} = u(x_t), \quad\ x_{t=0} =x , \quad\mbox{where}\quad \dot{x_t} = \frac{\text{d} ( t \mapsto x_t)}{\text{d} t}\]</div>
<p>The ODE are reversible and we want the solution at point <span class="math notranslate nohighlight">\(x\)</span> at time <span class="math notranslate nohighlight">\(t\)</span> ( not at point <span class="math notranslate nohighlight">\(x_t\)</span>) the initial point is <span class="math notranslate nohighlight">\(x_{-t}\)</span>, and we have</p>
<div class="math notranslate nohighlight">
\[c(x,t)=c^0(x_{-t},0)\]</div>
<p>The game consists in solving the equation until <span class="math notranslate nohighlight">\(T=2\pi\)</span>, that is for a full revolution and to compare the final solution with the initial one; they should be equal.</p>
</div>
<div class="section" id="solution-by-a-characteristics-galerkin-method">
<h2><strong>Solution by a Characteristics-Galerkin Method</strong><a class="headerlink" href="#solution-by-a-characteristics-galerkin-method" title="Permalink to this headline">¶</a></h2>
<p>In FreeFem++ there is an operator called <code class="code freefem docutils literal highlight highlight-freefem"><span></span>convect([u1,u2], dt, c)</code> which compute <span class="math notranslate nohighlight">\(c\circ X\)</span> with <span class="math notranslate nohighlight">\(X\)</span> is the convect field defined by <span class="math notranslate nohighlight">\(X(x)= x_{dt}\)</span> and where <span class="math notranslate nohighlight">\(x_\tau\)</span> is particule path in the steady state velocity field <span class="math notranslate nohighlight">\(\mathbf{u}=[u1,u2]\)</span> starting at point <span class="math notranslate nohighlight">\(x\)</span> at time <span class="math notranslate nohighlight">\(\tau=0\)</span>, so <span class="math notranslate nohighlight">\(x_\tau\)</span> is solution of the following ODE:</p>
<div class="math notranslate nohighlight">
\[\dot{x}_\tau = u(x_\tau), \mathbf{x}_{\tau=0}=x.\]</div>
<p>When <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is piecewise constant; this is possible because <span class="math notranslate nohighlight">\(x_\tau\)</span> is then a polygonal curve which can be computed exactly and the solution exists always when <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is divergence free; convect returns <span class="math notranslate nohighlight">\(c(x_{df})=C\circ X\)</span>.</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
real dt = 0.17;

// Mesh
border C(t=0., 2.*pi) {x=cos(t); y=sin(t);};
mesh Th = buildmesh(C(100));

// Fespace
fespace Uh(Th, P1);
Uh cold, c = exp(-10*((x-0.3)^2 +(y-0.3)^2));
Uh u1 = y, u2 = -x;

// Time loop
real t = 0;
for (int m = 0; m &lt; 2.*pi/dt; m++){
    t += dt;
    cold = c;
    c = convect([u1, u2], -dt, cold);
    plot(c, cmm=&quot; t=&quot;+t +&quot;, min=&quot;+c[].min+&quot;, max=&quot;+c[].max);
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">3D plots can be done by adding the qualifyer <code class="code freefem docutils literal highlight highlight-freefem"><span></span>dim=3</code> to the plot instruction.</p>
</div>
<p>The method is very powerful but has two limitations:</p>
<ul class="simple">
<li>a/ it is not conservative</li>
<li>b/ it may diverge in rare cases when <span class="math notranslate nohighlight">\(|\mathbf{u}|\)</span> is too small due to quadrature error.</li>
</ul>
</div>
<div class="section" id="solution-by-discontinuous-galerkin-fem">
<h2><strong>Solution by Discontinuous-Galerkin FEM</strong><a class="headerlink" href="#solution-by-discontinuous-galerkin-fem" title="Permalink to this headline">¶</a></h2>
<p>Discontinuous Galerkin methods take advantage of the discontinuities of <span class="math notranslate nohighlight">\(c\)</span> at the edges to build upwinding.
There are may formulations possible.
We shall implement here the so-called dual-<span class="math notranslate nohighlight">\(P_1^{DC}\)</span> formulation (see <a class="reference internal" href="#ern2006" id="id1">[ERN2006]</a>):</p>
<div class="math notranslate nohighlight">
\[\int_\Omega(\frac{c^{n+1}-c^n}{\delta t} +u\cdot\nabla c)w
+\int_E(\alpha|n\cdot u|-\frac 12 n\cdot u)[c]w
=\int_{E_\Gamma^-}|n\cdot u| cw~~~\forall w\]</div>
<p>where <span class="math notranslate nohighlight">\(E\)</span> is the set of inner edges and <span class="math notranslate nohighlight">\(E_\Gamma^-\)</span> is the set of boundary edges where <span class="math notranslate nohighlight">\(u\cdot n&lt;0\)</span> (in our case there is no such edges).
Finally <span class="math notranslate nohighlight">\([c]\)</span> is the jump of <span class="math notranslate nohighlight">\(c\)</span> across an edge with the convention that <span class="math notranslate nohighlight">\(c^+\)</span> refers to the value on the right of the oriented edge.</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
real al=0.5;
real dt = 0.05;

// Mesh
border C(t=0., 2.*pi) {x=cos(t); y=sin(t);};
mesh Th = buildmesh(C(100));

// Fespace
fespace Vh(Th,P1dc);
Vh w, ccold, v1 = y, v2 = -x, cc = exp(-10*((x-0.3)^2 +(y-0.3)^2));

// Macro
macro n() (N.x*v1 + N.y*v2) // Macro without parameter

// Problem
problem Adual(cc, w)
    = int2d(Th)(
          (cc/dt+(v1*dx(cc)+v2*dy(cc)))*w
    )
    + intalledges(Th)(
          (1-nTonEdge)*w*(al*abs(n)-n/2)*jump(cc)
    )
    - int2d(Th)(
          ccold*w/dt
    )
    ;

// Time iterations
for (real t = 0.; t &lt; 2.*pi; t += dt){
    ccold = cc;
    Adual;
    plot(cc, fill=1, cmm=&quot;t=&quot;+t+&quot;, min=&quot;+cc[].min+&quot;, max=&quot;+ cc[].max);
}

// Plot
real [int] viso = [-0.2, -0.1, 0., 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1., 1.1];
plot(cc, wait=1, fill=1, ps=&quot;ConvectCG.eps&quot;, viso=viso);
plot(cc, wait=1, fill=1, ps=&quot;ConvectDG.eps&quot;, viso=viso);
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>New keywords: <code class="code freefem docutils literal highlight highlight-freefem"><span></span>intalledges</code> to integrate on all edges of all triangles</p>
<div class="last math notranslate nohighlight">
\[\mathtt{intalledges}(\mathtt{Th}) \equiv \sum_{T\in\mathtt{Th}}\int_{\partial T }\]</div>
</div>
<p>(so all internal edges are see two times), nTonEdge which is one if the triangle has a boundary edge and two otherwise, <code class="code freefem docutils literal highlight highlight-freefem"><span></span>jump</code> to implement <span class="math notranslate nohighlight">\([c]\)</span>.</p>
<p>Results of both methods are shown on <a class="reference internal" href="#figrotatingcg"><span class="std std-numref">Fig. 52</span></a> nad <a class="reference internal" href="#figrotatingdg"><span class="std std-numref">Fig. 53</span></a> with identical levels for the level line; this is done with the plot-modifier viso.</p>
<p>Notice also the macro where the parameter <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is not used (but the syntax needs one) and which ends with a <code class="code freefem docutils literal highlight highlight-freefem"><span></span>//</code>; it simply replaces the name <code class="code freefem docutils literal highlight highlight-freefem"><span></span>n</code> by <code class="code freefem docutils literal highlight highlight-freefem"><span></span>(N.x*v1+N.y*v2)</code>.
As easily guessed <code class="code freefem docutils literal highlight highlight-freefem"><span></span>N.x,N.y</code> is the normal to the edge.</p>
<div class="inline2 figure" id="figrotatingcg">
<img alt="../_images/convectCG.png" src="../_images/convectCG.png" />
<p class="caption"><span class="caption-number">Fig. 52 </span><span class="caption-text">The rotating hill after one revolution with Characteristics-Galerkin</span></p>
</div>
<div class="inline2 figure" id="figrotatingdg">
<img alt="../_images/convectDG.png" src="../_images/convectDG.png" />
<p class="caption"><span class="caption-number">Fig. 53 </span><span class="caption-text">The rotating hill after one revolution with Discontinuous <span class="math notranslate nohighlight">\(P_1\)</span> Galerkin</span></p>
</div>
<p>Now if you think that DG is too slow try this:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
real al=0.5;
real dt = 0.05;

// Mesh
border C(t=0., 2.*pi) {x=cos(t); y=sin(t);};
mesh Th = buildmesh(C(100));

// Fespace
fespace Vh(Th,P1dc);
Vh w, ccold, v1 = y, v2 = -x, cc = exp(-10*((x-0.3)^2 +(y-0.3)^2));
Vh rhs=0;

// Macro
macro n() (N.x*v1 + N.y*v2) // Macro without parameter

// Problem
real t = 0.;

varf vAdual (cc, w)
    = int2d(Th)(
          (cc/dt+(v1*dx(cc)+v2*dy(cc)))*w
    )
    + intalledges(Th)(
          (1-nTonEdge)*w*(al*abs(n)-n/2)*jump(cc)
    )
    ;

varf vBdual (cc, w)
    = - int2d(Th)(
          ccold*w/dt
    )
    ;

matrix AA = vAdual(Vh, Vh);
matrix BB = vBdual(Vh, Vh);
set (AA, init=t, solver=sparsesolver);

// Time iterations
for (t = 0.; t &lt; 2.*pi; t += dt){
    ccold = cc;
    rhs[] = BB * ccold[];
    cc[] = AA^-1 * rhs[];
    plot(cc, fill=1, cmm=&quot;t=&quot;+t+&quot;, min=&quot;+cc[].min+&quot;, max=&quot;+ cc[].max);
}
</pre></div>
</div>
<p>Notice the new keyword <code class="code freefem docutils literal highlight highlight-freefem"><span></span>set</code> to specify a solver in this framework; the modifier <code class="code freefem docutils literal highlight highlight-freefem"><span></span>init</code> is used to tell the solver that the matrix has not changed (<code class="code freefem docutils literal highlight highlight-freefem"><span></span>init=true</code>), and the name parameter are the same that in problem definition (see <a class="reference internal" href="../documentation/finiteElement.html#problemdefinition"><span class="std std-ref">Problem</span></a>)</p>
</div>
<div class="section" id="finite-volume-methods-can-also-be-handled-with-freefem-but-it-requires-programming">
<h2><strong>Finite Volume Methods</strong> can also be handled with FreeFem++ but it requires programming.<a class="headerlink" href="#finite-volume-methods-can-also-be-handled-with-freefem-but-it-requires-programming" title="Permalink to this headline">¶</a></h2>
<p>For instance the <span class="math notranslate nohighlight">\(P_0-P_1\)</span> Finite Volume Method of Dervieux <em>et al</em> associates to each <span class="math notranslate nohighlight">\(P_0\)</span> function <span class="math notranslate nohighlight">\(c^1\)</span> a <span class="math notranslate nohighlight">\(P_0\)</span> function <span class="math notranslate nohighlight">\(c^0\)</span> with constant value around each vertex <span class="math notranslate nohighlight">\(q^i\)</span> equal to <span class="math notranslate nohighlight">\(c^1(q^i)\)</span> on the cell <span class="math notranslate nohighlight">\(\sigma_i\)</span> made by all the medians of all triangles having <span class="math notranslate nohighlight">\(q^i\)</span> as vertex.</p>
<p>Then upwinding is done by taking left or right values at the median:</p>
<div class="math notranslate nohighlight">
\[\int_{\sigma_i}\frac 1{\delta t}({c^1}^{n+1}-{c^1}^n) + \int_{\partial\sigma_i}u\cdot n c^-=0, \forall i\]</div>
<p>It can be programmed as :</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>load &quot;mat_dervieux&quot;; //External module in C++ must be loaded

// Parameters
real dt = 0.025;

// Mesh
border a(t=0., 2.*pi){x=cos(t); y=sin(t);}
mesh th = buildmesh(a(100));

// Fespace
fespace Vh(th,P1);
Vh vh, vold, u1=y, u2=-x;
Vh v=exp(-10*((x-0.3)^2 +(y-0.3)^2)), vWall=0, rhs=0;

// Problem
//qf1pTlump means mass lumping is used
problem FVM(v,vh) = int2d(th,qft=qf1pTlump)(v*vh/dt)
    - int2d(th,qft=qf1pTlump)(vold*vh/dt)
    + int1d(th,a)(((u1*N.x+u2*N.y)&lt;0)*(u1*N.x+u2*N.y)*vWall*vh)
+ rhs[] ;

matrix A;
MatUpWind0(A, th, vold, [u1, u2]);

// Time loop
for (int t = 0; t &lt; 2.*pi ; t += dt){
    vold = v;
    rhs[] = A * vold[];
    FVM;
    plot(v, wait=0);
}
</pre></div>
</div>
<p>the “mass lumping” parameter forces a quadrature formula with Gauss points at the vertices so as to make the mass matrix diagonal; the linear system solved by a conjugate gradient method for instance will then converge in one or two iterations.</p>
<p>The right hand side <code class="docutils literal highlight highlight-freefem"><span></span>rhs</code> is computed by an external C++ function <code class="docutils literal highlight highlight-freefem"><span></span>MatUpWind0(...)</code> which is programmed as :</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Computes matrix a on a triangle for the Dervieux FVM</span>
<span class="kt">int</span> <span class="nf">fvmP1P0</span><span class="p">(</span><span class="kt">double</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="c1">// the 3 vertices of a triangle T</span>
    <span class="kt">double</span> <span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="c1">// convection velocity on T</span>
    <span class="kt">double</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="c1">// the P1 function on T</span>
    <span class="kt">double</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="c1">// output matrix</span>
    <span class="kt">double</span> <span class="n">where</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">// where&gt;0 means we&#39;re on the boundary</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">ip</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">,</span> <span class="n">ipp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ip</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">unL</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="n">ipp</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="n">ipp</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">unL</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">unL</span><span class="p">;</span>
            <span class="n">a</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span><span class="n">unL</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">ip</span><span class="p">]</span> <span class="o">+=</span> <span class="n">unL</span><span class="p">;</span>
            <span class="n">a</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="n">ip</span><span class="p">]</span> <span class="o">-=</span><span class="n">unL</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">where</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">where</span><span class="p">[</span><span class="n">ip</span><span class="p">]){</span> <span class="c1">// this is a boundary edge</span>
            <span class="n">unL</span> <span class="o">=</span> <span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unL</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">unL</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="n">ip</span><span class="p">]</span> <span class="o">+=</span> <span class="n">unL</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It must be inserted into a larger .cpp file, shown in Appendix A, which is the load module linked to FreeFem++.</p>
<table class="docutils citation" frame="void" id="ern2006" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[ERN2006]</a></td><td>ERN, A. et GUERMOND, J. L. Discontinuous Galerkin methods for Friedrichs’ symmetric systems. I. General theory. SIAM J. Numer. Anal.</td></tr>
</tbody>
</table>
</div>
</div>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
<div class="localtoc">
    <p class="caption">
      <span class="caption-text">Table Of Contents</span>
    </p>
    <ul>
<li><a class="reference internal" href="#">Pure Convection : The Rotating Hill</a><ul>
<li><a class="reference internal" href="#summary"><strong>Summary:</strong></a></li>
<li><a class="reference internal" href="#solution-by-a-characteristics-galerkin-method"><strong>Solution by a Characteristics-Galerkin Method</strong></a></li>
<li><a class="reference internal" href="#solution-by-discontinuous-galerkin-fem"><strong>Solution by Discontinuous-Galerkin FEM</strong></a></li>
<li><a class="reference internal" href="#finite-volume-methods-can-also-be-handled-with-freefem-but-it-requires-programming"><strong>Finite Volume Methods</strong> can also be handled with FreeFem++ but it requires programming.</a></li>
</ul>
</li>
</ul>

</div>
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="fanBlade.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Irrotational Fan Blade Flow and Thermal effects</div>
         </div>
     </a>
     <a id="button-next" href="elasticity.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>The System of elasticity</div>
        </div>
     </a>
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FreeFem++</div>
      <div>
        
        <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Mathematical Models</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2018, FreeFem++.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.3 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>