<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>A Large Fluid Problem &#8212; FreeFem++ 3.61.2 documentation</title>

    <link rel="stylesheet" href="../_static/material-icons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/notosanscjkjp.css" />
    <link rel="stylesheet" type="text/css" href="../_static/roboto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material-design-lite-1.3.0/material.indigo-pink.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_materialdesign_theme.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sphinx_materialdesign_theme.js"></script>
    <link rel="canonical" href="doc.freefem.org/dev/tutorial/aLargeFluidProblem.html" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="An Example with Complex Numbers" href="complexNumbers.html" />
    <link rel="prev" title="Newton Method for the Steady Navier-Stokes equations" href="navierStokesNewton.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link" href="index.html">Tutorials</a><i class="material-icons">navigate_next</i>
            <a class="mdl-navigation__link is-active">A Large Fluid Problem</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="../search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
<a id="button-show-source"
    class="mdl-button mdl-js-button mdl-button--icon"
    href="../_sources/tutorial/aLargeFluidProblem.rst.txt" rel="nofollow">
<i class="material-icons">code</i>
</a>
<div class="mdl-tooltip" data-mdl-for="button-show-source">
Show Source
</div>
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="rotatingHill.html">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Mathematical Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../model/model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/evolutionProblems.html">Evolution problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/navierStokesEquations.html">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="rotatingHill.html">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Mathematical Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../model/model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/evolutionProblems.html">Evolution problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/navierStokesEquations.html">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <div class="section" id="a-large-fluid-problem">
<h1>A Large Fluid Problem<a class="headerlink" href="#a-large-fluid-problem" title="Permalink to this headline">¶</a></h1>
<p>A friend of one of us in Auroville-India was building a ramp to access an air conditioned room.
As I was visiting the construction site he told me that he expected to cool air escaping by the door to the room to slide down the ramp and refrigerate the feet of the coming visitors.
I told him “no way” and decided to check numerically.</p>
<p>The fluid velocity and pressure are solution of the Navier-Stokes equations with varying density function of the temperature.</p>
<p>The geometry is trapezoidal with prescribed inflow made of cool air at the bottom and warm air above and so are the initial conditions; there is free outflow, slip velocity at the top (artificial) boundary and no-slip at the bottom.
However the Navier-Stokes cum temperature equations have a RANS <span class="math notranslate nohighlight">\(k-\epsilon\)</span> model and a Boussinesq approximation for the buoyancy.
This comes to :</p>
<div class="math notranslate nohighlight">
\[\begin{split}\partial_t\theta+u\nabla\theta-\nabla\cdot(\kappa_T^m\nabla\theta) &amp;=&amp; 0\\
\partial_t u +u\nabla u -\nabla\cdot(\mu_T\nabla u) +\nabla p+ e(\theta-\theta_0)\vec e_2 &amp;=&amp;0\\
\nabla\cdot u &amp;=&amp; 0\\
\mu_T &amp;=&amp; c_\mu\frac{k^2}\epsilon\\
\kappa_T &amp;=&amp; \kappa\mu_T\\
\partial_t k + u\nabla k + \epsilon -\nabla\cdot(\mu_T\nabla k) &amp;=&amp; \frac{\mu_T}2|\nabla u+\nabla u^T|^2\\
\partial_t\epsilon+u\nabla\epsilon + c_2\frac{\epsilon^2} k -\frac{c_\epsilon}{c_\mu}\nabla\cdot (\mu_T\nabla\epsilon) &amp;=&amp; \frac{c_1}2 k|\nabla u+\nabla u^T|^2\\\end{split}\]</div>
<p>We use a time discretization which preserves positivity and uses the method of characteristics (<span class="math notranslate nohighlight">\(X^m(x)\approx x-u^m(x)\delta t\)</span>)</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac 1{\delta t}(\theta^{m+1}-\theta^m \circ X^m)-\nabla\cdot(\kappa_T^m\nabla\theta^{m+1}) &amp;=&amp; 0\\
\frac1{\delta t}(u^{m+1}-u^m \circ X^m) -\nabla\cdot(\mu_T^m\nabla u^{m+1}) +\nabla p^{m+1}+ e(\theta^{m+1}-\theta_0)\vec e_2 &amp;=&amp; 0\\
\nabla\cdot u^{m+1} &amp;=&amp; 0\\
\frac1{\delta t}(k^{m+1}-k^m \circ X^m) + k^{m+1}\frac{\epsilon^m}{k^m} -\nabla\cdot(\mu_T^m\nabla k^{m+1}) &amp;=&amp; \frac{\mu_T^m}2|\nabla u^m+{\nabla u^m}^T|^2\\
\frac1{\delta t}(\epsilon^{m+1}-\epsilon^m \circ X^m) + c_2\epsilon^{m+1}\frac{\epsilon^m} {k^m} -\frac{c_\epsilon}{c_\mu}\nabla\dot(\mu_T^m\nabla\epsilon^{m+1}) &amp;=&amp; \frac{c_1}2 k^m|\nabla u^m+{\nabla u^m}^T|^2\\
\mu_T ^{m+1} &amp;=&amp; c_\mu\frac{{k^{m+1}}^2}{\epsilon^{m+1}}\\
\kappa_T^{m+1} &amp;=&amp; \kappa\mu_T^{m+1}\end{split}\]</div>
<p>In variational form and with appropriated boundary conditions the problem is :</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>load &quot;iovtk&quot;

verbosity=0;

// Parameters
int nn = 15;
int nnPlus = 5;
real l = 1.;
real L = 15.;
real hSlope = 0.1;
real H = 6.;
real h = 0.5;

real reylnods =500;
real beta = 0.01;

real eps = 9.81/303.;
real nu = 1;
real numu = nu/sqrt(0.09);
real nuep = pow(nu,1.5)/4.1;
real dt = 0.;

real Penalty = 1.e-6;

// Mesh
border b1(t=0, l){x=t; y=0;}
border b2(t=0, L-l){x=1.+t; y=-hSlope*t;}
border b3(t=-hSlope*(L-l), H){x=L; y=t;}
border b4(t=L, 0){x=t; y=H;}
border b5(t=H, h){x=0; y=t;}
border b6(t=h, 0){x=0; y=t;}

mesh Th=buildmesh(b1(nnPlus*nn*l) + b2(nn*sqrt((L-l)^2+(hSlope*(L-l))^2)) + b3(nn*(H + hSlope*(L-l))) + b4(nn*L) + b5(nn*(H-h)) + b6(nnPlus*nn*h));
plot(Th);

// Fespaces
fespace Vh2(Th, P1b);
Vh2 Ux, Uy;
Vh2 Vx, Vy;
Vh2 Upx, Upy;

fespace Vh(Th,P1);
Vh p=0, q;
Vh Tp, T=35;
Vh k=0.0001, kp=k;
Vh ep=0.0001, epp=ep;

fespace V0h(Th,P0);
V0h muT=1;
V0h prodk, prode;
Vh kappa=0.25e-4, stress;

// Macro
macro grad(u) [dx(u), dy(u)] //
macro Grad(U) [grad(U#x), grad(U#y)] //
macro Div(U) (dx(U#x) + dy(U#y)) //

// Functions
func g = (x) * (1-x) * 4;

// Problem
real alpha = 0.;

problem Temperature(T, q)
   = int2d(Th)(
        alpha * T * q
      + kappa* grad(T)&#39; * grad(q)
   )
   + int2d(Th)(
      - alpha*convect([Upx, Upy], -dt, Tp)*q
   )
   + on(b6, T=25)
   + on(b1, b2, T=30)
   ;

problem KineticTurbulence(k, q)
   = int2d(Th)(
        (epp/kp + alpha) * k * q
      + muT* grad(k)&#39; * grad(q)
   )
   + int2d(Th)(
        prodk * q
      - alpha*convect([Upx, Upy], -dt, kp)*q
   )
   + on(b5, b6, k=0.00001)
   + on(b1, b2, k=beta*numu*stress)
   ;

problem ViscosityTurbulence(ep, q)
   = int2d(Th)(
        (1.92*epp/kp + alpha) * ep * q
      + muT * grad(ep)&#39; * grad(q)
   )
   + int1d(Th, b1, b2)(
        T * q * 0.001
   )
   + int2d(Th)(
        prode * q
      - alpha*convect([Upx, Upy], -dt, epp)*q
   )
   + on(b5, b6, ep=0.00001)
   + on(b1, b2, ep=beta*nuep*pow(stress,1.5))
   ;

// Initialization with stationary solution
solve NavierStokes ([Ux, Uy, p], [Vx, Vy, q])
   = int2d(Th)(
        alpha * [Ux, Uy]&#39; * [Vx, Vy]
      + muT * (Grad(U) : Grad(V))
      + p * q * Penalty
      - p * Div(V)
      - Div(U) * q
   )
   + int1d(Th, b1, b2, b4)(
        Ux * Vx * 0.1
   )
   + int2d(Th)(
        eps * (T-35) * Vx
      - alpha*convect([Upx, Upy], -dt, Upx)*Vx
      - alpha*convect([Upx, Upy], -dt, Upy)*Vy
   )
   + on(b6, Ux=3, Uy=0)
   + on(b5, Ux=0, Uy=0)
   + on(b1, b4, Uy=0)
   + on(b2, Uy=-Upx*N.x/N.y)
   + on(b3, Uy=0)
   ;

plot([Ux, Uy], p, value=true, coef=0.2, cmm=&quot;[Ux, Uy] - p&quot;);

{
   real[int] xx(21), yy(21), pp(21);
   for (int i = 0 ; i &lt; 21; i++){
      yy[i] = i/20.;
      xx[i] = Ux(0.5,i/20.);
      pp[i] = p(i/20.,0.999);
   }
   cout &lt;&lt; &quot; &quot; &lt;&lt; yy &lt;&lt; endl;
   plot([xx, yy], wait=true, cmm=&quot;Ux x=0.5 cup&quot;);
   plot([yy, pp], wait=true, cmm=&quot;p y=0.999 cup&quot;);
}

// Initialization
dt = 0.1; //probably too big
int nbiter = 3;
real coefdt = 0.25^(1./nbiter);
real coefcut = 0.25^(1./nbiter);
real cut = 0.01;
real tol = 0.5;
real coeftol = 0.5^(1./nbiter);
nu = 1./reylnods;

T = T - 10*((x&lt;1)*(y&lt;0.5) + (x&gt;=1)*(y+0.1*(x-1)&lt;0.5));

// Convergence loop
real T0 = clock();
for (int iter = 1; iter &lt;= nbiter; iter++){
   cout &lt;&lt; &quot;Iteration &quot; &lt;&lt; iter &lt;&lt; &quot; - dt = &quot; &lt;&lt; dt &lt;&lt; endl;
   alpha = 1/dt;

   // Time loop
   real t = 0.;
   for (int i = 0; i &lt;= 500; i++){
      t += dt;
      cout &lt;&lt; &quot;Time step &quot; &lt;&lt; i &lt;&lt; &quot; - t = &quot; &lt;&lt; t &lt;&lt; endl;

      // Update
      Upx = Ux;
      Upy = Uy;
      kp = k;
      epp = ep;
      Tp = max(T, 25); //for beauty only should be removed
      Tp = min(Tp, 35); //for security only should be removed
      kp = max(k, 0.0001); epp = max(ep, 0.0001); // to be secure: should not be active
      muT = 0.09*kp*kp/epp;

      // Solve NS
      NavierStokes;

      // Update
      prode = -0.126*kp*(pow(2*dx(Ux),2)+pow(2*dy(Uy),2)+2*pow(dx(Uy)+dy(Ux),2))/2;
      prodk = -prode*kp/epp*0.09/0.126;
      kappa = muT/0.41;
      stress = abs(dy(Ux));

      // Solve k-eps-T
      KineticTurbulence;
      ViscosityTurbulence;
      Temperature;

      // Plot
      plot(T, value=true, fill=true);
      plot([Ux, Uy], p, coef=0.2, cmm=&quot; [Ux, Uy] - p&quot;, WindowIndex=1);

      // Time
      cout &lt;&lt; &quot;\tTime = &quot; &lt;&lt; clock()-T0 &lt;&lt; endl;
   }

   // Check
   if (iter &gt;= nbiter) break;

   // Adaptmesh
   Th = adaptmesh(Th, [dx(Ux), dy(Ux), dx(Ux), dy(Uy)], splitpbedge=1, abserror=0, cutoff=cut, err=tol, inquire=0, ratio=1.5, hmin=1./1000);
   plot(Th);

   // Update
   dt = dt * coefdt;
   tol = tol * coeftol;
   cut = cut * coefcut;
}
cout &lt;&lt; &quot;Total Time = &quot; &lt;&lt; clock()-T0 &lt;&lt; endl;
</pre></div>
</div>
<div class="inline2 figure" id="id1">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_T_100.png"><img alt="../_images/ALargeFluidProblem_T_100.png" src="../_images/ALargeFluidProblem_T_100.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 62 </span><span class="caption-text">Temperature at time step 100</span></p>
</div>
<div class="inline2 figure" id="id2">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_U_100.png"><img alt="../_images/ALargeFluidProblem_U_100.png" src="../_images/ALargeFluidProblem_U_100.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 63 </span><span class="caption-text">Velocity at time step 100</span></p>
</div>
<div class="inline2 figure" id="id3">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_T_200.png"><img alt="../_images/ALargeFluidProblem_T_200.png" src="../_images/ALargeFluidProblem_T_200.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 64 </span><span class="caption-text">Temperature at time step 200</span></p>
</div>
<div class="inline2 figure" id="id4">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_U_200.png"><img alt="../_images/ALargeFluidProblem_U_200.png" src="../_images/ALargeFluidProblem_U_200.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 65 </span><span class="caption-text">Velocity at time step 200</span></p>
</div>
<div class="inline2 figure" id="id5">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_T_300.png"><img alt="../_images/ALargeFluidProblem_T_300.png" src="../_images/ALargeFluidProblem_T_300.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 66 </span><span class="caption-text">Temperature at time step 300</span></p>
</div>
<div class="inline2 figure" id="id6">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_U_300.png"><img alt="../_images/ALargeFluidProblem_U_300.png" src="../_images/ALargeFluidProblem_U_300.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 67 </span><span class="caption-text">Velocity at time step 300</span></p>
</div>
<div class="inline2 figure" id="id7">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_T_400.png"><img alt="../_images/ALargeFluidProblem_T_400.png" src="../_images/ALargeFluidProblem_T_400.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 68 </span><span class="caption-text">Temperature at time step 400</span></p>
</div>
<div class="inline2 figure" id="id8">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_U_400.png"><img alt="../_images/ALargeFluidProblem_U_400.png" src="../_images/ALargeFluidProblem_U_400.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 69 </span><span class="caption-text">Velocity at time step 400</span></p>
</div>
<div class="inline2 figure" id="id9">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_T_500.png"><img alt="../_images/ALargeFluidProblem_T_500.png" src="../_images/ALargeFluidProblem_T_500.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 70 </span><span class="caption-text">Temperature at time step 500</span></p>
</div>
<div class="inline2 figure" id="id10">
<a class="reference internal image-reference" href="../_images/ALargeFluidProblem_U_500.png"><img alt="../_images/ALargeFluidProblem_U_500.png" src="../_images/ALargeFluidProblem_U_500.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 71 </span><span class="caption-text">Velocity at time step 500</span></p>
</div>
</div>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="navierStokesNewton.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Newton Method for the Steady Navier-Stokes equations</div>
         </div>
     </a>
     <a id="button-next" href="complexNumbers.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>An Example with Complex Numbers</div>
        </div>
     </a>
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FreeFem++</div>
      <div>
        
        <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Mathematical Models</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2018, FreeFem++.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.3 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>