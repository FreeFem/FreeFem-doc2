<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Non-linear elasticity</title>
		<link rel="icon" href="../_static/img/favicon.png">

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

		<!-- FreeFem++ theme specific -->
		<link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

		<!-- css -->
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

		<!-- js -->
		<script src="../_static/nav.json"></script>
		<script src="../_static/js/nav.js"></script>
		<script src="../_static/js/common.js"></script>

		<!-- MathJax -->
		<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
			<div class="header-logo">
    <div>
        <a href="../introduction/introduction.html">
            <img alt="logo" title="FreeFem++ documentation" src="../_static/img/Logo.png" />
        </a>
    </div>
</div>
<div class="header-title">
    <div>
        <a href="../introduction/introduction.html">
            <h2>FreeFem++ documentation</h2>
        </a>
    </div>
</div>
<div class="header-github">
    <a href="https://github.com/FreeFem/FreeFem-sources">
        <div class="header-github-img">
            <img alt="GitHub" title="FreeFem++ on GitHub" src="../_static/img/GitHub-Mark-120px-plus.png" />
        </div>
        <div class="header-github-title">
            <div class="header-github-title-text">
                FreeFem++ on GitHub
            </div>
            <div class="header-github-title-stars">
                <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
            </div>
        </div>
    </a>
</div>
<script src="../_static/js/github.js"></script>
		</header>
		
		<nav>
			<script>nav("../")</script>
			<div class="search">
				<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr_index.js"></script>

<script src="../_static/js/search.js"></script>

<div class="search">
    <input type="search" id="searchInput" placeholder="Search..." oninput="search(this.value);" />
    <div class="searchResults">
        <div id="resultCount">
        </div>
        <div id="searchResults">
        </div>
    </div>
</div>
			</div>
		</nav>
		

		
		<div class="container">
			<div class="toc" id="toc">
				<div>
					<ul>
<li><a class="reference internal" href="#">Non-linear elasticity</a></li>
</ul>

				</div>
			</div>
			<div class="content">
				<div>
					
    <div class="math notranslate nohighlight">
\[\def\p{{\partial}}\]</div>
<div class="section" id="non-linear-elasticity">
<h1>Non-linear elasticity<a class="headerlink" href="#non-linear-elasticity" title="Permalink to this headline">Â¶</a></h1>
<p>The nonlinear elasticity problem is: find the displacement <span class="math notranslate nohighlight">\((u_{1},u_{2})\)</span> minimizing <span class="math notranslate nohighlight">\(J\)</span>:</p>
<div class="math notranslate nohighlight">
\[\min J(u_{1},u_{2}) = \int_{\Omega} f(F2) - \int_{\Gamma_{p}} P_{a} \, u_{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(F2(u_{1},u_{2}) = A(E[u_{1},u_{2}],E[u_{1},u_{2}])\)</span> and <span class="math notranslate nohighlight">\(A(X,Y)\)</span> is bilinear symmetric positive form with respect two matrix <span class="math notranslate nohighlight">\(X,Y\)</span>.</p>
<p>where <span class="math notranslate nohighlight">\(f\)</span> is a given <span class="math notranslate nohighlight">\(\mathcal{C}^2\)</span> function, and <span class="math notranslate nohighlight">\(E[u_{1},u_{2}] = (E_{ij})_{i=1,2,\,j=1,2}\)</span> is the Green-Saint Venant deformation tensor defined with:</p>
<div class="math notranslate nohighlight">
\[E_{ij} = 0.5 \big( ( \p_i u_j + \p_j u_i ) + \sum_k \p_i u_k {\times} \p_j u_k \big)\]</div>
<p>Denote <span class="math notranslate nohighlight">\(\mathbf{u}=(u_{1},u_{2})\)</span>, <span class="math notranslate nohighlight">\(\mathbf{v}=(v_{1},v_{2})\)</span>, <span class="math notranslate nohighlight">\(\mathbf{w}=(w_{1},w_{2})\)</span>.
So, the differential of <span class="math notranslate nohighlight">\(J\)</span> is:</p>
<div class="math notranslate nohighlight">
\[DJ(\mathbf{u})(\mathbf{v}) = \int DF2(\mathbf{u})(\mathbf{v}) \;f'(F2(\mathbf{u}))) - \int_{\Gamma_{p}} P_{a} v_{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(DF2(\mathbf{u})(\mathbf{v}) = 2 \; A(DE[\mathbf{u}](\mathbf{v}),E[\mathbf{u}])\)</span> and <span class="math notranslate nohighlight">\(DE\)</span> is the first differential of <span class="math notranslate nohighlight">\(E\)</span>.</p>
<p>The second order differential is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    D^2 J(\mathbf{u})((\mathbf{v}),(\mathbf{w})) &amp;=&amp; \displaystyle\int DF2(\mathbf{u})(\mathbf{v}) \; DF2(\mathbf{u})(\mathbf{w}) \; f''(F2(\mathbf{u}))) \\
    &amp;+&amp; \displaystyle\int \; D^2F2(\mathbf{u})(\mathbf{v},\mathbf{w}) \; f'(F2(\mathbf{u})))
\end{array}\end{split}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[D^2F2(\mathbf{u})(\mathbf{v},\mathbf{w}) = 2 \; A(\;D^2E[\mathbf{u}](\mathbf{v},\mathbf{w})\;,\;E[\mathbf{u}]\;) + 2 \; A(\;DE[\mathbf{u}](\mathbf{v})\;,DE[\mathbf{u}](\mathbf{w})\;) .\]</div>
<p>and <span class="math notranslate nohighlight">\(D^{2}E\)</span> is the second differential of <span class="math notranslate nohighlight">\(E\)</span>.</p>
<p>So all notations can be define with <a class="reference internal" href="../reference/types.html#typemacrodesign"><span class="std std-ref">macro</span></a>:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">macro</span> <span class="n">EL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="c1">//is [epsilon_11, 2epsilon_12, epsilon_22]</span>

<span class="kt">macro</span> <span class="n">ENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">[</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span>
    <span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span>
<span class="p">]</span> <span class="c1">//</span>

<span class="kt">macro</span> <span class="n">dENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="p">[</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">vv</span><span class="p">)),</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span>
    <span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">vv</span><span class="p">))</span>
<span class="p">]</span> <span class="c1">//</span>

<span class="kt">macro</span> <span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">(</span><span class="n">EL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">ENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">))</span> <span class="c1">//is [E_11, 2E_12, E_22]</span>
<span class="kt">macro</span> <span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="p">(</span><span class="n">EL</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="n">dENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">))</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">ddE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">)</span> <span class="n">dENL</span><span class="p">(</span><span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">F2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">dF2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span><span class="o">*</span><span class="mf">2.</span><span class="p">)</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">ddF2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">)</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">))</span><span class="o">*</span><span class="mf">2.</span>
    <span class="o">+</span> <span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">ddE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">))</span><span class="o">*</span><span class="mf">2.</span>
<span class="p">)</span> <span class="c1">//</span>
</pre></div>
</div>
<p>The Newton Method is:</p>
<p>choose <span class="math notranslate nohighlight">\(n=0\)</span>,and <span class="math notranslate nohighlight">\(u_0,v_0\)</span> the initial displacement</p>
<ul>
<li><p class="first">loop:</p>
<ul>
<li><p class="first">find <span class="math notranslate nohighlight">\((du,dv)\)</span> : solution of</p>
<div class="math notranslate nohighlight">
\[D^2J(u_n,v_n)((w,s),(du,dv)) = DJ(u_n,v_n)(w,s) , \quad \forall w,s\]</div>
</li>
<li><p class="first"><span class="math notranslate nohighlight">\(un = un - du,\quad vn =vn - dv\)</span></p>
</li>
<li><p class="first">until <span class="math notranslate nohighlight">\((du,dv)\)</span> small is enough</p>
</li>
</ul>
</li>
</ul>
<p>The way to implement this algorithm in FreeFem++ is use a macro tool to implement <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(F2\)</span>, <span class="math notranslate nohighlight">\(f\)</span>, <span class="math notranslate nohighlight">\(f'\)</span>,<span class="math notranslate nohighlight">\(f''\)</span>.</p>
<p>A macro is like in <code class="code cpp docutils literal highlight highlight-cpp"><span></span><span class="n">ccp</span></code> preprocessor of C++, but this begin by <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kt">macro</span></code> and the end of the macro definition is before the comment <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="c1">//</span></code>.
In this case the macro is very useful because the type of parameter can be change.
And it is easy to make automatic differentiation.</p>
<div class="figure" id="id1">
<img alt="../_images/NonLinearElasticity_Mesh1.png" src="../_images/NonLinearElasticity_Mesh1.png" />
<p class="caption"><span class="caption-number">Fig. 224 </span><span class="caption-text">The deformed domain</span></p>
</div>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="nf">EL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="c1">//is [epsilon_11, 2epsilon_12, epsilon_22]</span>

<span class="kt">macro</span> <span class="n">ENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">[</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span>
    <span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="p">]</span> <span class="c1">//</span>

<span class="kt">macro</span> <span class="n">dENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="p">[</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">vv</span><span class="p">)),</span>
    <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span>
    <span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">vv</span><span class="p">))</span>
    <span class="p">]</span> <span class="c1">//</span>

<span class="kt">macro</span> <span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">(</span><span class="n">EL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">ENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">))</span> <span class="c1">//is [E_11, 2E_12, E_22]</span>
<span class="kt">macro</span> <span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="p">(</span><span class="n">EL</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="n">dENL</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">))</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">ddE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">)</span> <span class="n">dENL</span><span class="p">(</span><span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">F2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">dF2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span><span class="o">*</span><span class="mf">2.</span><span class="p">)</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">ddF2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">)</span> <span class="p">(</span>
      <span class="p">(</span><span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">dE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">))</span><span class="o">*</span><span class="mf">2.</span>
    <span class="o">+</span> <span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">&#39;*</span><span class="kp">A</span><span class="o">*</span><span class="n">ddE</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">uuu</span><span class="p">,</span> <span class="n">vvv</span><span class="p">))</span><span class="o">*</span><span class="mf">2.</span>
    <span class="p">)</span> <span class="c1">//</span>

<span class="kt">macro</span> <span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">((</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span><span class="p">)</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">df</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">((</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">ddf</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1">//</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.012e5</span><span class="p">;</span> <span class="c1">//kg/cm^2</span>
<span class="kt">real</span> <span class="n">lambda</span> <span class="o">=</span> <span class="mf">0.4e5</span><span class="p">;</span> <span class="c1">//kg/cm^2</span>
<span class="kt">real</span> <span class="n">Pa</span> <span class="o">=</span> <span class="mf">1e2</span><span class="p">;</span>

<span class="c1">// sigma = 2 mu E + lambda tr(E) Id</span>
<span class="c1">// A(u,v) = sigma(u):E(v)</span>
<span class="c1">//</span>
<span class="c1">// ( a b )</span>
<span class="c1">// ( b c )</span>
<span class="c1">//</span>
<span class="c1">// tr*Id : (a,b,c) -&gt; (a+c,0,a+c)</span>
<span class="c1">// so the associed matrix is:</span>
<span class="c1">// ( 1 0 1 )</span>
<span class="c1">// ( 0 0 0 )</span>
<span class="c1">// ( 1 0 1 )</span>

<span class="kt">real</span> <span class="n">a11</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> <span class="n">lambda</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a22</span> <span class="o">=</span> <span class="n">mu</span><span class="p">;</span> <span class="c1">//because [0, 2*t12, 0]&#39; A [0, 2*s12,0] = 2*mu*(t12*s12 + t21*s21) = 4*mu*t12*s12</span>
<span class="kt">real</span> <span class="n">a33</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> <span class="n">lambda</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a12</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a13</span> <span class="o">=</span> <span class="n">lambda</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a23</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// symetric part</span>
<span class="kt">real</span> <span class="n">a21</span> <span class="o">=</span> <span class="n">a12</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a31</span> <span class="o">=</span> <span class="n">a13</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a32</span> <span class="o">=</span> <span class="n">a23</span><span class="p">;</span>

<span class="c1">//the matrix A</span>
<span class="kt">func</span> <span class="kp">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span> <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span> <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]];</span>

<span class="c1">// Mesh</span>
<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="kt">int</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="kr">m</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="mf">.3</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span> <span class="c1">//label: 1 bottom, 2 right, 3 up, 4 left;</span>
<span class="kt">int</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">left</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Wh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1dc</span><span class="p">);</span>
<span class="n">Wh</span> <span class="n">e2</span><span class="p">,</span> <span class="n">fe2</span><span class="p">,</span> <span class="n">dfe2</span><span class="p">,</span> <span class="n">ddfe2</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P1</span><span class="p">,</span> <span class="nc">P1</span><span class="p">]);</span>
<span class="n">Vh</span> <span class="p">[</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="p">[</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>

<span class="kt">fespace</span> <span class="nf">Sh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Sh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="kt">varf</span> <span class="nf">vmass</span> <span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">uu</span><span class="o">*</span><span class="n">w</span> <span class="o">+</span> <span class="n">vv</span><span class="o">*</span><span class="n">s</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">M</span> <span class="o">=</span> <span class="n">vmass</span><span class="p">(</span><span class="n">Vh</span><span class="p">,</span> <span class="n">Vh</span><span class="p">);</span>
<span class="kt">problem</span> <span class="nf">NonLin</span><span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">LU</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">qforder</span><span class="o">=</span><span class="mi">1</span><span class="p">)(</span> <span class="c1">//(D^2 J(un))</span>
           <span class="n">dF2</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span><span class="o">*</span><span class="n">dF2</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">ddfe2</span>
        <span class="o">+</span> <span class="n">ddF2</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">ddfe2</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">upper</span><span class="p">)(</span>
          <span class="n">Pa</span><span class="o">*</span><span class="n">s</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">qforder</span><span class="o">=</span><span class="mi">1</span><span class="p">)(</span> <span class="c1">//(D J(un))</span>
          <span class="n">dF2</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">dfe2</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">uu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Newton&#39;s method</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Loop &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// Update</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">F2</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">);</span>
    <span class="n">dfe2</span> <span class="o">=</span> <span class="n">df</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span> <span class="p">;</span>
    <span class="n">ddfe2</span> <span class="o">=</span> <span class="n">ddf</span><span class="p">(</span><span class="n">e2</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;e2 max = &quot;</span> <span class="o">&lt;&lt;</span><span class="n">e2</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, min = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e2</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;de2 max = &quot;</span><span class="o">&lt;&lt;</span> <span class="n">dfe2</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, min = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">dfe2</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;dde2 max = &quot;</span><span class="o">&lt;&lt;</span> <span class="n">ddfe2</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, min = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ddfe2</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// Solve</span>
    <span class="n">NonLin</span><span class="p">;</span>
    <span class="n">w</span><span class="p">[]</span>  <span class="o">=</span> <span class="n">M</span><span class="o">*</span><span class="n">uu</span><span class="p">[];</span>

    <span class="c1">// Residual</span>
    <span class="kt">real</span> <span class="n">res</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">w</span><span class="p">[]</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">uu</span><span class="p">[]);</span> <span class="c1">//L^2 norm of [uu, vv]</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; L^2 residual = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// Update</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">vv</span><span class="p">;</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">uu</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;u1 min = &quot;</span> <span class="o">&lt;&lt;</span><span class="n">u1</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, u1 max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u1</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;v1 min = &quot;</span> <span class="o">&lt;&lt;</span><span class="n">v1</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, v2 max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">v1</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// Plot</span>
    <span class="nf">plot</span><span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;uu, vv&quot;</span><span class="p">);</span>

    <span class="c1">// Update</span>
    <span class="n">un</span><span class="p">[]</span> <span class="o">-=</span> <span class="n">uu</span><span class="p">[];</span>
    <span class="nf">plot</span><span class="p">([</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;</span><span class="kp">displacement</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">([</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="c1">// Movemesh</span>
<span class="kt">mesh</span> <span class="n">th1</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">+</span><span class="n">un</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">vn</span><span class="p">]);</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">th1</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</div>
</div>


				</div>
			</div>
		</div>
		
		<footer>
			<script>
    let date = new Date()
    let currentYear = date.getFullYear()
</script>
<div class="footer-text">
    <a href="https://freefem.org/">FreeFem++</a> 1987-<script>document.write(currentYear)</script>
</div>
<div class="footer-img">
    <p>
        Made with <i class="fas fa-heart"></i> on
    </p>
    <span class="separator"></span>
    <a href="https://github.com/FreeFem">
        <img alt="Github" title="Github" src="../_static/img/GitHub_Logo_White.png" />
    </a>
</div>
		</footer>
		

		<script src="../_static/js/toc.js"></script>
	</body>
</html>