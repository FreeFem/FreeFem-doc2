<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Fluid-structure coupled problem</title>
		<link rel="icon" href="../_static/img/favicon.png">

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

		<!-- FreeFem++ theme specific -->
		<link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

		<!-- css -->
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

		<!-- js -->
		<script src="../_static/nav.json"></script>
		<script src="../_static/js/nav.js"></script>
		<script src="../_static/js/common.js"></script>

		<!-- MathJax -->
		<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
			<div class="header-logo">
    <div>
        <a href="../introduction/introduction.html">
            <img alt="logo" title="FreeFem++ documentation" src="../_static/img/Logo.png" />
        </a>
    </div>
</div>
<div class="header-title">
    <div>
        <a href="../introduction/introduction.html">
            <h2>FreeFem++ documentation</h2>
        </a>
    </div>
</div>
<div class="header-github">
    <a href="https://github.com/FreeFem/FreeFem-sources">
        <div class="header-github-img">
            <img alt="GitHub" title="FreeFem++ on GitHub" src="../_static/img/GitHub-Mark-120px-plus.png" />
        </div>
        <div class="header-github-title">
            <div class="header-github-title-text">
                FreeFem++ on GitHub
            </div>
            <div class="header-github-title-stars">
                <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
            </div>
        </div>
    </a>
</div>
<script src="../_static/js/github.js"></script>
		</header>
		
		<nav>
			<script>nav("../")</script>
			<div class="search">
				<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr_index.js"></script>

<script src="../_static/js/search.js"></script>

<div class="search">
    <input type="search" id="searchInput" placeholder="Search..." oninput="search(this.value);" />
    <div class="searchResults">
        <div id="resultCount">
        </div>
        <div id="searchResults">
        </div>
    </div>
</div>
			</div>
		</nav>
		

		
		<div class="container">
			<div class="toc" id="toc">
				<div>
					<ul>
<li><a class="reference internal" href="#">Fluid-structure coupled problem</a></li>
</ul>

				</div>
			</div>
			<div class="content">
				<div>
					
    <div class="section" id="fluid-structure-coupled-problem">
<h1>Fluid-structure coupled problem<a class="headerlink" href="#fluid-structure-coupled-problem" title="Permalink to this headline">¶</a></h1>
<p>This problem involves the Lamé system of elasticity and the Stokes system for viscous fluids with velocity <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> and pressure <span class="math notranslate nohighlight">\(p\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcll}
    -\Delta\mathbf{u} + \mathbf{\nabla} p &amp;=&amp; 0 &amp; \hbox{ in }\Omega\\
    \nabla\cdot\mathbf{u} &amp;=&amp; 0 &amp; \hbox{ in }\Omega\\
    \mathbf{u} &amp;=&amp; \mathbf{u}_\Gamma &amp; \hbox{ on }\Gamma=\partial\Omega
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(u_\Gamma\)</span> is the velocity of the boundaries.
The force that the fluid applies to the boundaries is the normal stress</p>
<div class="math notranslate nohighlight">
\[\mathbf{h} =(\nabla\mathbf{u} +\nabla\mathbf{u}^T)\mathbf{n} -p\mathbf{n}\]</div>
<p>Elastic solids subject to forces deform: a point in the solid at (x,y) goes to (X,Y) after.
When the displacement vector <span class="math notranslate nohighlight">\(\mathbf{v}=(v_1,v_2) = (X-x, Y-y)\)</span> is small, Hooke’s law relates the stress tensor <span class="math notranslate nohighlight">\(\sigma\)</span> inside the solid to the deformation tensor <span class="math notranslate nohighlight">\(\epsilon\)</span>:</p>
<div class="math notranslate nohighlight">
\[\sigma_{ij} = \lambda \delta_{ij} \nabla.\mathbf{v} + 2\mu\epsilon_{ij},
\,
\epsilon_{ij} = {1\over 2}({\partial v_i\over\partial x_j} + {\partial v_j\over\partial x_i} )\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta\)</span> is the Kronecker symbol and where <span class="math notranslate nohighlight">\(\lambda\)</span>, <span class="math notranslate nohighlight">\(\mu\)</span> are two constants describing the material mechanical properties in terms of the modulus of elasticity, and Young’s modulus.</p>
<p>The equations of elasticity are naturally written in variational form for the displacement vector <span class="math notranslate nohighlight">\(v(x)\in V\)</span> as:</p>
<div class="math notranslate nohighlight">
\[\int_\Omega \left[2\mu\epsilon_{ij}(\mathbf{v})\epsilon_{ij}(\mathbf{w})
+\lambda \epsilon_{ii}(v)\epsilon_{jj}(\mathbf{w})\right]
=\int_\Omega \mathbf{g}\cdot \mathbf{w} +\int_\Gamma \mathbf{h}\cdot \mathbf{w},%\`{u}
\forall \mathbf{w}\in V\]</div>
<p>The data are the gravity force <span class="math notranslate nohighlight">\(\mathbf{g}\)</span> and the boundary stress <span class="math notranslate nohighlight">\(\mathbf{h}\)</span>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Fluide-structure
In our example, the Lamé system and the Stokes system are coupled by a common boundary on which the fluid stress creates a displacement of the boundary and hence changes the shape of the domain where the Stokes problem is integrated.
The geometry is that of a vertical driven cavity with an elastic lid.
The lid is a beam with weight so it will be deformed by its own weight and by the normal stress due to the fluid reaction.
The cavity is the <span class="math notranslate nohighlight">\(10 \times 10\)</span> square and the lid is a rectangle of height <span class="math notranslate nohighlight">\(l=2\)</span>.</p>
<p>A beam sits on a box full of fluid rotating because the left vertical side has velocity one.
The beam is bent by its own weight, but the pressure of the fluid modifies the bending.</p>
<p>The bending displacement of the beam is given by <span class="math notranslate nohighlight">\((uu, vv)\)</span> whose solution is given as follows.</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">bottombeam</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//label of bottombeam</span>
<span class="kt">real</span> <span class="n">E</span> <span class="o">=</span> <span class="mf">21.5</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">sigma</span> <span class="o">=</span> <span class="mf">0.29</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">gravity</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">coef</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>

<span class="c1">// Mesh (solid)</span>
<span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">b</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">bottombeam</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">c</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">d</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">10</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">3</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="nf">d</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>

<span class="c1">// Fespace (solid)</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">uu</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">s</span><span class="p">;</span>

<span class="c1">// Macro</span>
<span class="kt">real</span> <span class="n">sqrt2</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">);</span>
<span class="kt">macro</span> <span class="nf">epsilon</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">),</span> <span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">+</span><span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span><span class="o">/</span><span class="n">sqrt2</span><span class="p">]</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">div</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span> <span class="c1">//</span>

<span class="c1">// Problem (solid)</span>
<span class="kt">real</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="kp">sigma</span><span class="p">));</span>
<span class="kt">real</span> <span class="n">lambda</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="kp">sigma</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="kp">sigma</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="kp">sigma</span><span class="p">));</span>
<span class="kt">solve</span> <span class="nf">Elasticity</span><span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">])</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)(</span>
          <span class="n">lambda</span><span class="o">*</span><span class="n">div</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">div</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">vv</span><span class="p">)</span>
        <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">epsilon</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="o">&#39;*</span><span class="n">epsilon</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">vv</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">gravity</span><span class="o">*</span><span class="n">s</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="nf">plot</span><span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
<span class="kt">mesh</span> <span class="n">th1</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">+</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">vv</span><span class="p">]);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">th1</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Then Stokes equation for fluids at low speed are solved in the box below the beam, but the beam has deformed the box (see border h):</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Mesh (fluid)</span>
<span class="kt">border</span> <span class="nf">e</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">10</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span> <span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">f</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">10</span><span class="o">+</span><span class="kp">t</span> <span class="p">;</span> <span class="kr">label</span><span class="o">=</span> <span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">g</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span> <span class="mi">2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">h</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">vv</span><span class="p">(</span><span class="kp">t</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="kp">t</span><span class="o">&gt;=</span><span class="mf">0.001</span> <span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span> <span class="o">&lt;=</span> <span class="mf">9.999</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">3</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">sh</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</div>
<p>We use the Uzawa conjugate gradient to solve the Stokes problem like in <a class="reference internal" href="navierStokesEquations.html#navierstokesuzawaconjugategradients"><span class="std std-ref">Navier-Stokes equations</span></a>.</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Fespace (fluid)</span>
<span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">bc1</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">brhs</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">bcx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bcy</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">,</span> <span class="n">ppp</span><span class="p">;</span>

<span class="c1">// Problem (fluid)</span>
<span class="kt">varf</span> <span class="nf">bx</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">sh</span><span class="p">)(</span><span class="o">-</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">by</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">sh</span><span class="p">)(</span><span class="o">-</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">Lap</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">sh</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="n">bc1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Lap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

<span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span> <span class="n">Lap</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">Bx</span> <span class="o">=</span> <span class="n">bx</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">By</span> <span class="o">=</span> <span class="n">by</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">);</span>


<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">divup</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pp</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">verb</span> <span class="o">=</span> <span class="kr">verbosity</span><span class="p">;</span>
    <span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">brhs</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">&#39;*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">brhs</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">bc1</span><span class="p">[]</span> <span class="p">.</span><span class="o">*</span><span class="n">bcx</span><span class="p">[];</span>
    <span class="n">u1</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">brhs</span><span class="p">[];</span>
    <span class="n">brhs</span><span class="p">[]</span> <span class="o">=</span> <span class="n">By</span><span class="o">&#39;*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">brhs</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">bc1</span><span class="p">[]</span> <span class="p">.</span><span class="o">*</span><span class="n">bcy</span><span class="p">[];</span>
    <span class="n">u2</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">brhs</span><span class="p">[];</span>
    <span class="n">ppp</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">*</span><span class="n">u1</span><span class="p">[];</span>
    <span class="n">ppp</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">By</span><span class="o">*</span><span class="n">u2</span><span class="p">[];</span>
    <span class="kr">verbosity</span> <span class="o">=</span> <span class="n">verb</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ppp</span><span class="p">[];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>do a loop on the two problems</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Coupling loop</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">step</span><span class="p">){</span>
    <span class="c1">// Solve (fluid)</span>
    <span class="nf">LinearCG</span><span class="p">(</span><span class="n">divup</span><span class="p">,</span> <span class="n">p</span><span class="p">[],</span> <span class="kp">eps</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
    <span class="n">divup</span><span class="p">(</span><span class="n">p</span><span class="p">[]);</span>
</pre></div>
</div>
<p>Now the beam will feel the stress constraint from the fluid:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Forces</span>
<span class="n">Vh</span> <span class="n">sigma11</span><span class="p">,</span> <span class="n">sigma22</span><span class="p">,</span> <span class="n">sigma12</span><span class="p">;</span>
<span class="n">Vh</span> <span class="n">uu1</span><span class="o">=</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv1</span><span class="o">=</span><span class="n">vv</span><span class="p">;</span>

<span class="n">sigma11</span><span class="p">([</span><span class="kr">x</span><span class="o">+</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">vv</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
<span class="n">sigma22</span><span class="p">([</span><span class="kr">x</span><span class="o">+</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">vv</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
<span class="n">sigma12</span><span class="p">([</span><span class="kr">x</span><span class="o">+</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">vv</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">));</span>
</pre></div>
</div>
<p>which comes as a boundary condition to the PDE of the beam:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Solve (solid)</span>
<span class="kt">solve</span> <span class="nf">Elasticity2</span> <span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="kp">init</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
<span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)(</span>
      <span class="n">lambda</span><span class="o">*</span><span class="n">div</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">div</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">vv</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">epsilon</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="o">&#39;*</span><span class="n">epsilon</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">vv</span><span class="p">))</span>
<span class="p">)</span>
<span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)(</span>
    <span class="o">-</span> <span class="n">gravity</span><span class="o">*</span><span class="n">s</span>
<span class="p">)</span>
<span class="o">+</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">bottombeam</span><span class="p">)(</span>
    <span class="o">-</span> <span class="kp">coef</span><span class="o">*</span><span class="p">(</span><span class="n">sigma11</span><span class="o">*</span><span class="kr">N</span><span class="p">.</span><span class="kr">x</span><span class="o">*</span><span class="n">w</span> <span class="o">+</span> <span class="n">sigma22</span><span class="o">*</span><span class="kr">N</span><span class="p">.</span><span class="kr">y</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">sigma12</span><span class="o">*</span><span class="p">(</span><span class="kr">N</span><span class="p">.</span><span class="kr">y</span><span class="o">*</span><span class="n">w</span><span class="o">+</span><span class="kr">N</span><span class="p">.</span><span class="kr">x</span><span class="o">*</span><span class="n">s</span><span class="p">))</span>
<span class="p">)</span>
<span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">;</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">([</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Error</span>
<span class="kt">real</span> <span class="kp">err</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)((</span><span class="n">uu</span><span class="o">-</span><span class="n">uu1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">vv</span><span class="o">-</span><span class="n">vv1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">));</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Erreur L2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">err</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>Notice that the matrix generated by <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="n">Elasticity2</span></code> is reused (see <a class="reference internal" href="../reference/types.html#typeproblemdesign"><span class="std std-ref">init=i</span></a>).
Finally we deform the beam:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Movemesh</span>
<span class="n">th1</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">+</span><span class="mf">0.2</span><span class="o">*</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="mf">0.2</span><span class="o">*</span><span class="n">vv</span><span class="p">]);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">th1</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Fluid velocity and pressure, displacement vector of the structure and displaced geometry in the fluid-structure interaction of a soft side and a driven cavity are shown <a class="reference internal" href="#figfsi1"><span class="std std-numref">Fig. 215</span></a>, <a class="reference internal" href="#figfsi2"><span class="std std-numref">Fig. 216</span></a> and <a class="reference internal" href="#figfsi3"><span class="std std-numref">Fig. 217</span></a></p>
<div class="figure" id="figfsi1">
<img alt="../_images/FluidStructure1.png" src="../_images/FluidStructure1.png" />
<p class="caption"><span class="caption-number">Fig. 215 </span><span class="caption-text">Velocity and pressure</span></p>
</div>
<div class="figure" id="figfsi2">
<img alt="../_images/FluidStructure2.png" src="../_images/FluidStructure2.png" />
<p class="caption"><span class="caption-number">Fig. 216 </span><span class="caption-text">Displacement</span></p>
</div>
<div class="last figure" id="figfsi3">
<img alt="../_images/FluidStructure3.png" src="../_images/FluidStructure3.png" />
<p class="caption"><span class="caption-number">Fig. 217 </span><span class="caption-text">Moved mesh</span></p>
</div>
</div>
</div>


				</div>
			</div>
		</div>
		
		<footer>
			<script>
    let date = new Date()
    let currentYear = date.getFullYear()
</script>
<div class="footer-text">
    <a href="https://freefem.org/">FreeFem++</a> 1987-<script>document.write(currentYear)</script>
</div>
<div class="footer-img">
    <p>
        Made with <i class="fas fa-heart"></i> on
    </p>
    <span class="separator"></span>
    <a href="https://github.com/FreeFem">
        <img alt="Github" title="Github" src="../_static/img/GitHub_Logo_White.png" />
    </a>
</div>
		</footer>
		

		<script src="../_static/js/toc.js"></script>
	</body>
</html>