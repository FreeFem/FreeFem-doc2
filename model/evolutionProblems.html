<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>Evolution problems &#8212; FreeFem++ 3.61.2 documentation</title>

    <link rel="stylesheet" href="../_static/material-icons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/notosanscjkjp.css" />
    <link rel="stylesheet" type="text/css" href="../_static/roboto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material-design-lite-1.3.0/material.indigo-pink.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_materialdesign_theme.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sphinx_materialdesign_theme.js"></script>
    <link rel="canonical" href="doc.freefem.org/dev/model/evolutionProblems.html" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Navier-Stokes equations" href="navierStokesEquations.html" />
    <link rel="prev" title="Eigen value problems" href="eigenValueProblems.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link" href="index.html">Mathematical Models</a><i class="material-icons">navigate_next</i>
            <a class="mdl-navigation__link is-active">Evolution problems</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="../search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
<a id="button-show-source"
    class="mdl-button mdl-js-button mdl-button--icon"
    href="../_sources/model/evolutionProblems.rst.txt" rel="nofollow">
<i class="material-icons">code</i>
</a>
<div class="mdl-tooltip" data-mdl-for="button-show-source">
Show Source
</div>
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/rotatingHill.html">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/aLargeFluidProblem.html">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Mathematical Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Evolution problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesEquations.html">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/rotatingHill.html">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/aLargeFluidProblem.html">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Mathematical Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Evolution problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="navierStokesEquations.html">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <div class="section" id="evolution-problems">
<h1>Evolution problems<a class="headerlink" href="#evolution-problems" title="Permalink to this headline">¶</a></h1>
<p>FreeFem++ also solves evolution problems such as the heat equation:</p>
<div class="math notranslate nohighlight" id="equation-eqn-heatequation">
<span class="eqno">(44)<a class="headerlink" href="#equation-eqn-heatequation" title="Permalink to this equation">¶</a></span>\[\begin{split}\frac{\p u}{\p t}-\mu\Delta u &amp;=&amp; f &amp; \textrm{ in }\Omega\times ]0,T[\\
u(\mathbf{x},0) &amp;=&amp; u_0(\mathbf{x}) &amp; \textrm{ in }\Omega\\
\left(\p u/\p n\right)(\mathbf{x},t) &amp;=&amp; 0 &amp; \textrm{ on }\p\Omega\times ]0,T[\end{split}\]</div>
<p>with a positive viscosity coefficient <span class="math notranslate nohighlight">\(\mu\)</span> and homogeneous Neumann boundary conditions.</p>
<p>We solve <a class="reference internal" href="#equation-eqn-heatequation">(44)</a> by FEM in space and finite differences in time.</p>
<p>We use the definition of the partial derivative of the solution in the time derivative,</p>
<div class="math notranslate nohighlight">
\[\frac{\p u}{\p t}(x,y,t) = \lim_{\tau \to 0}\frac{u(x,y,t)-u(x,y,t-\tau )}{\tau }\]</div>
<p>which indicates that <span class="math notranslate nohighlight">\(u^m(x,y)=u(x,y,m\tau )\)</span> will satisfy approximatively</p>
<div class="math notranslate nohighlight">
\[\frac{\p u}{\p t}(x,y,m\tau )\simeq \frac{u^m(x,y)-u^{m-1}(x,y)}{\tau }\]</div>
<p>The time discretization of heat equation <a class="reference internal" href="#equation-eqn-heatequation">(44)</a> is as follows, <span class="math notranslate nohighlight">\(\forall m=0,\cdots,[T/\tau ]\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{u^{m+1}-u^{m}}{\tau }-\mu\Delta u^{m+1} &amp;=&amp; f^{m+1} &amp; \textrm{ in }\Omega\\
u^0(\mathbf{x}) &amp;=&amp; u_0(\mathbf{x}) &amp; \textrm{ in }\Omega\\
\p u^{m+1}/\p n(\mathbf{x}) &amp;=&amp; 0 &amp; \textrm{ on }\p\Omega\end{split}\]</div>
<p>which is so-called <em>backward Euler method</em> for <a class="reference internal" href="#equation-eqn-heatequation">(44)</a>.</p>
<p>To obtain the variational formulation, multiply with the test function <span class="math notranslate nohighlight">\(v\)</span> both sides of the equation:</p>
<div class="math notranslate nohighlight">
\[\int_{\Omega}\{u^{m+1}v-\tau \Delta u^{m+1}v\}=\int_{\Omega}\{u^m+\tau f^{m+1}\}v\]</div>
<p>By the divergence theorem, we have</p>
<div class="math notranslate nohighlight">
\[\int_{\Omega}\{u^{m+1}v+\tau\nabla u^{m+1}\cdot \nabla v\}
-\int_{\p\Omega} \tau \left( \p u^{m+1}/\p n\right) v
=\int_{\Omega }\{u^mv+\tau f^{m+1}v\}\]</div>
<p>By the boundary condition <span class="math notranslate nohighlight">\(\p u^{m+1}/\p n=0\)</span>, it follows that</p>
<div class="math notranslate nohighlight" id="equation-eqn-heatequationbwe">
<span class="eqno">(45)<a class="headerlink" href="#equation-eqn-heatequationbwe" title="Permalink to this equation">¶</a></span>\[\int_{\Omega} \{u^{m+1}v+\tau \nabla u^{m+1}\cdot \nabla v\}
-\int_{\Omega }\{u^mv+\tau f^{m+1}v\}
=0\]</div>
<p>Using the identity just above, we can calculate the finite element approximation <span class="math notranslate nohighlight">\(u_h^m\)</span> of <span class="math notranslate nohighlight">\(u^m\)</span> in a step-by-step manner with respect to <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Example</p>
<p>We now solve the following example with the exact solution <span class="math notranslate nohighlight">\(u(x,y,t)=tx^4\)</span>, <span class="math notranslate nohighlight">\(\Omega = ]0,1[^2\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{{\p u}}{{\p t}} - \mu \Delta u &amp;=&amp; x^4 - \mu 12tx^2 &amp; \textrm{ in }\Omega\times ]0,3[\\
u(x,y,0) &amp;=&amp; 0 &amp; \textrm{ on }\Omega\\
\left. u \right|_{\p\Omega} &amp;=&amp; t*x^4\end{split}\]</div>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
real dt = 0.1;
real mu = 0.01;

// Mesh
mesh Th = square(16, 16);

// Fespace
fespace Vh(Th, P1);
Vh u, v, uu, f, g;

// Problem
problem dHeat (u, v)
    = int2d(Th)(
          u*v
        + dt*mu*(dx(u)*dx(v) + dy(u)*dy(v))
    )
    + int2d(Th)(
        - uu*v
        - dt*f*v
    )
    + on(1, 2, 3, 4, u=g)
    ;

// Time loop
real t = 0;
uu = 0;
for (int m = 0; m &lt;= 3/dt; m++){
    // Update
    t = t+dt;
    f = x^4 - mu*t*12*x^2;
    g = t*x^4;
    uu = u;

    // Solve
    dHeat;

    // Plot
    plot(u, wait=true);
    cout &lt;&lt; &quot;t=&quot; &lt;&lt; t &lt;&lt; &quot; - L^2-Error=&quot; &lt;&lt; sqrt(int2d(Th)((u-t*x^4)^2)) &lt;&lt; endl;
}
</pre></div>
</div>
<p>In the last statement, the <span class="math notranslate nohighlight">\(L^2\)</span>-error <span class="math notranslate nohighlight">\(\left(\int_{\Omega}\left| u-tx^4\right|^2\right)^{1/2}\)</span> is calculated at <span class="math notranslate nohighlight">\(t=m\tau, \tau =0.1\)</span>. At <span class="math notranslate nohighlight">\(t=0.1\)</span>, the error is 0.000213269. The errors increase with <span class="math notranslate nohighlight">\(m\)</span> and 0.00628589 at <span class="math notranslate nohighlight">\(t=3\)</span>.</p>
<p>The iteration of the backward Euler <a class="reference internal" href="#equation-eqn-heatequationbwe">(45)</a> is made by [<cite>:::freefem for</cite> loop](/reference/Loops/#for).</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The stiffness matrix in the loop is used over and over again. FreeFem++ support reuses of stiffness matrix.</p>
</div>
</div>
<div class="section" id="mathematical-theory-on-time-difference-approximations">
<h2>Mathematical Theory on Time Difference Approximations.<a class="headerlink" href="#mathematical-theory-on-time-difference-approximations" title="Permalink to this headline">¶</a></h2>
<p>In this section, we show the advantage of implicit schemes.
Let <span class="math notranslate nohighlight">\(V, H\)</span> be separable Hilbert space and <span class="math notranslate nohighlight">\(V\)</span> is dense in <span class="math notranslate nohighlight">\(H\)</span>.
Let <span class="math notranslate nohighlight">\(a\)</span> be a continuous bilinear form over <span class="math notranslate nohighlight">\(V \times V\)</span> with coercivity and symmetry.</p>
<p>Then <span class="math notranslate nohighlight">\(\sqrt{a(v,v)}\)</span> become equivalent to the norm <span class="math notranslate nohighlight">\(\| v\|\)</span> of <span class="math notranslate nohighlight">\(V\)</span>.</p>
<p><strong>Problem Ev:math:`(f,Omega)`</strong>: For a given <span class="math notranslate nohighlight">\(f\in L^2(0,T;V'),\, u^0\in H\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{d}{dt}(u(t),v)+a(u(t),v)&amp;=&amp;( f(t),v)\qquad \forall v\in V,\quad a.e. \, t\in [0,T]\\
u(0)&amp;=&amp;u^0\nonumber\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(V'\)</span> is the dual space of <span class="math notranslate nohighlight">\(V\)</span>.</p>
<p>Then, there is an unique solution <span class="math notranslate nohighlight">\(u\in L^{\infty}(0,T;H)\cap L^2(0,T;V)\)</span>.</p>
<p>Let us denote the time step by <span class="math notranslate nohighlight">\(\tau&gt;0\)</span>, <span class="math notranslate nohighlight">\(N_T=[T/\tau]\)</span>.
For the discretization, we put <span class="math notranslate nohighlight">\(u^n = u(n\tau)\)</span> and consider the time difference for each <span class="math notranslate nohighlight">\(\theta\in [0,1]\)</span></p>
<div class="math notranslate nohighlight" id="equation-eqn-t-method">
<span class="eqno">(46)<a class="headerlink" href="#equation-eqn-t-method" title="Permalink to this equation">¶</a></span>\[\begin{split}\frac{1}{\tau}\left( u_h^{n+1}-u_h^n,\phi_i\right)
+a\left( u_h^{n+\theta},\phi_i\right)=\langle f^{n+\theta},\phi_i\rangle\\
i=1,\cdots, m,\quad n=0,\cdots, N_T\nonumber\\
u_h^{n+\theta}=\theta u_h^{n+1}+(1-\theta)u_h^n,\quad
f^{n+\theta}=\theta f^{n+1}+(1-\theta)f^n\nonumber\end{split}\]</div>
<p>Formula <a class="reference internal" href="#equation-eqn-t-method">(46)</a> is the <em>forward Euler scheme</em> if <span class="math notranslate nohighlight">\(\theta=0\)</span>, <em>Crank-Nicolson scheme</em> if <span class="math notranslate nohighlight">\(\theta=1/2\)</span>, the <em>backward Euler scheme</em> if <span class="math notranslate nohighlight">\(\theta=1\)</span>.</p>
<p>Unknown vectors <span class="math notranslate nohighlight">\(u^n=(u_h^1,\cdots,u_h^M)^T\)</span> in</p>
<div class="math notranslate nohighlight">
\[u_h^n(x)=u^n_1\phi_1(x)+\cdots+u^n_m\phi_m(x),\quad u^n_1,\cdots,u^n_m\in \R\]</div>
<p>are obtained from solving the matrix</p>
<div class="math notranslate nohighlight" id="equation-eqn-evolution-1">
<span class="eqno">(47)<a class="headerlink" href="#equation-eqn-evolution-1" title="Permalink to this equation">¶</a></span>\[\begin{split}(M+\theta\tau A)u^{n+1}=\{M-(1-\theta)\tau A\}u^n
+\tau\left\{\theta f^{n+1}+(1-\theta)f^n\right\}\\
M=(m_{ij}),\quad m_{ij}=(\phi_j,\phi_i),\qquad
A=(a_{ij}),\quad a_{ij}=a(\phi_j,\phi_i)\nonumber\end{split}\]</div>
<p>Refer <a class="reference internal" href="#tabata1994" id="id1">[TABATA1994]</a>, pp.70–75 for solvability of <a class="reference internal" href="#equation-eqn-evolution-1">(47)</a>. The stability of <a class="reference internal" href="#equation-eqn-evolution-1">(47)</a> is in <a class="reference internal" href="#tabata1994" id="id2">[TABATA1994]</a>, Theorem 2.13:</p>
<p>Let <span class="math notranslate nohighlight">\(\{\mathcal{T}_h\}_{h\downarrow 0}\)</span> be regular triangulations (see <a class="reference external" href="/documentation/MeshGeneration/#regular-triangulation-htriangle">Regular Triangulation</a>).
Then there is a number <span class="math notranslate nohighlight">\(c_0&gt;0\)</span> independent of <span class="math notranslate nohighlight">\(h\)</span> such that,</p>
<div class="math notranslate nohighlight">
\[\begin{split}|u_h^n|^2\le
\left\{
\begin{array}{lr}
\frac{1}{\delta}\left\{
|u^0_h|^2+\tau \sum_{k=0}^{n-1}\|f^{k+\theta}\|^2_{V_h'}
\right\}&amp;\theta\in [0,1/2)\\
|u^0_h|^2+\tau \sum_{k=0}^{n-1}\|f^{k+\theta}\|^2_{V_h'}&amp;\theta\in [1/2,1]
\end{array}
\right.\end{split}\]</div>
<p>if the following are satisfied:</p>
<ol class="arabic">
<li><p class="first">When <span class="math notranslate nohighlight">\(\theta\in [0,1/2)\)</span>, then we can take a time step <span class="math notranslate nohighlight">\(\tau\)</span> in such a way that</p>
<div class="math notranslate nohighlight">
\[\tau &lt;\frac{2(1-\delta)}{(1-2\theta)c_0^2}h^2\]</div>
<p>for arbitrary <span class="math notranslate nohighlight">\(\delta\in (0,1)\)</span>.</p>
</li>
<li><p class="first">When <span class="math notranslate nohighlight">\(1/2\leq \theta\leq 1\)</span>, we can take <span class="math notranslate nohighlight">\(\tau\)</span> arbitrary.</p>
</li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Example</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
real tau = 0.1; real
theta = 0.;

// Mesh
mesh Th = square(12, 12);

// Fespace
fespace Vh(Th, P1);
Vh u, v, oldU;
Vh f1, f0;

fespace Ph(Th, P0);
Ph h = hTriangle; // mesh sizes for each triangle

// Function
func real f (real t){
    return x^2*(x-1)^2 + t*(-2 + 12*x - 11*x^2 - 2*x^3 + x^4);
}

// File
ofstream out(&quot;err02.csv&quot;); //file to store calculations
out &lt;&lt; &quot;mesh size = &quot; &lt;&lt; h[].max &lt;&lt; &quot;, time step = &quot; &lt;&lt; tau &lt;&lt; endl;
for (int n = 0; n &lt; 5/tau; n++)
    out &lt;&lt; n*tau &lt;&lt; &quot;,&quot;;
out &lt;&lt; endl;

// Problem
problem aTau (u, v)
    = int2d(Th)(
          u*v
        + theta*tau*(dx(u)*dx(v) + dy(u)*dy(v) + u*v)
    )
    - int2d(Th)(
          oldU*v
        - (1-theta)*tau*(dx(oldU)*dx(v) + dy(oldU)*dy(v) + oldU*v)
    )
    - int2d(Th)(
          tau*(theta*f1 + (1-theta)*f0)*v
    )
    ;

// Theta loop
while (theta &lt;= 1.0){
    real t = 0;
    real T = 3;
    oldU = 0;
    out &lt;&lt; theta &lt;&lt; &quot;,&quot;;
    for (int n = 0; n &lt; T/tau; n++){
        // Update
        t = t + tau;
        f0 = f(n*tau);
        f1 = f((n+1)*tau);

        // Solve
        aTau;
        oldU = u;

        // Plot
        plot(u);

        // Error
        Vh uex = t*x^2*(1-x)^2; //exact solution = tx^2(1-x)^2
        Vh err = u - uex; // err = FE-sol - exact
        out &lt;&lt; abs(err[].max)/abs(uex[].max) &lt;&lt; &quot;,&quot;;
    }
    out &lt;&lt; endl;
    theta = theta + 0.1;
}
</pre></div>
</div>
<div class="figure" id="figevolutiontimediff">
<img alt="../_images/EvolutionProblems_TimeDifference.png" src="../_images/EvolutionProblems_TimeDifference.png" />
<p class="caption"><span class="caption-number">Fig. 147 </span><span class="caption-text"><span class="math notranslate nohighlight">\(\max_{x\in\Omega}\vert u_h^n(\theta)-u_{ex}(n\tau)\vert\max_{x\in\Omega}\vert u_{ex}(n\tau)\vert$ at $n=0,1,\cdots,29\)</span></span></p>
</div>
<p class="last">We can see in <a class="reference internal" href="#figevolutiontimediff"><span class="std std-numref">Fig. 147</span></a> that <span class="math notranslate nohighlight">\(u_h^n(\theta)\)</span> become unstable at <span class="math notranslate nohighlight">\(\theta=0.4\)</span>, and figures are omitted in the case <span class="math notranslate nohighlight">\(\theta&lt;0.4\)</span>.</p>
</div>
</div>
<div class="section" id="convection">
<h2>Convection<a class="headerlink" href="#convection" title="Permalink to this headline">¶</a></h2>
<p>The hyperbolic equation</p>
<div class="math notranslate nohighlight" id="equation-eqn-conv">
<span class="eqno">(48)<a class="headerlink" href="#equation-eqn-conv" title="Permalink to this equation">¶</a></span>\[\p_t u +\mathbf{\alpha} \cdot \nabla u=f;\ \textrm{ for a vector-valued function }\mathbf{\alpha}\]</div>
<p>appears frequently in scientific problems, for example in the Navier-Stokes equations, in the Convection-Diffusion equation, etc.</p>
<p>In the case of 1-dimensional space, we can easily find the general solution <span class="math notranslate nohighlight">\((x,t)\mapsto u(x,t)=u^0(x-\alpha t)\)</span> of the following equation, if <span class="math notranslate nohighlight">\(\alpha\)</span> is constant,</p>
<div class="math notranslate nohighlight" id="equation-eqn-conv0">
<span class="eqno">(49)<a class="headerlink" href="#equation-eqn-conv0" title="Permalink to this equation">¶</a></span>\[\begin{split}\p_t u +\alpha\p_x u &amp;=&amp; 0\\
u(x,0) &amp;=&amp; u^0(x),\end{split}\]</div>
<p>because <span class="math notranslate nohighlight">\(\p_t u +\alpha\p_x u=-\alpha\dot{u}^0+a\dot{u}^0=0\)</span>, where <span class="math notranslate nohighlight">\(\dot{u}^0=du^0(x)/dx\)</span>.</p>
<p>Even if <span class="math notranslate nohighlight">\(\alpha\)</span> is not constant, the construction works on similar principles.
One begins with the ordinary differential equation (with the convention that <span class="math notranslate nohighlight">\(\alpha\)</span> is prolonged by zero apart from <span class="math notranslate nohighlight">\((0,L)\times (0,T)\)</span>):</p>
<div class="math notranslate nohighlight">
\[\dot{X}(\tau )=+\alpha(X(\tau ),\tau ),\ \tau \in (0,t)\quad X(t)=x\]</div>
<p>In this equation <span class="math notranslate nohighlight">\(\tau\)</span> is the variable and <span class="math notranslate nohighlight">\(x,t\)</span> are parameters, and we denote the solution by <span class="math notranslate nohighlight">\(X_{x,t}(\tau )\)</span>.
Then it is noticed that <span class="math notranslate nohighlight">\((x,t)\rightarrow v(X(\tau),\tau)\)</span> in <span class="math notranslate nohighlight">\(\tau=t\)</span> satisfies the equation</p>
<div class="math notranslate nohighlight">
\[\p _{t}v+\alpha\p _{x}v=\p _{t}X\dot{v}+a\p _{x}X\dot{v}%
=0\]</div>
<p>and by the definition <span class="math notranslate nohighlight">\(\p _{t}X=\dot{X}=+\alpha\)</span> and <span class="math notranslate nohighlight">\(\p_{x}X=\p _{x}x\)</span> in <span class="math notranslate nohighlight">\(\tau=t\)</span>, because if <span class="math notranslate nohighlight">\(\tau =t\)</span> we have <span class="math notranslate nohighlight">\(X(\tau )=x\)</span>.</p>
<p>The general solution of <a class="reference internal" href="#equation-eqn-conv0">(49)</a> is thus the value of the boundary condition in <span class="math notranslate nohighlight">\(X_{x, t}(0)\)</span>, that is to say <span class="math notranslate nohighlight">\(u(x,t)=u^{0}(X_{x,t}(0))\)</span> where <span class="math notranslate nohighlight">\(X_{x,t}(0)\)</span> is on the <span class="math notranslate nohighlight">\(x\)</span> axis, <span class="math notranslate nohighlight">\(u(x,t)=u^{0}(X_{x,t}(0))\)</span> if <span class="math notranslate nohighlight">\(X_{x,t}(0)\)</span> is on the axis of <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>In higher dimension <span class="math notranslate nohighlight">\(\Omega \subset R^{d},~d=2,3\)</span>, the equation for the convection is written</p>
<div class="math notranslate nohighlight">
\[\p _{t}u+\mathbf{\alpha}\cdot \nabla u=0\hbox{ in }\Omega \times (0,T)\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{a}(x,t)\in R^{d}\)</span>.</p>
<p>FreeFem++ implements the Characteristic-Galerkin method for convection operators.
Recall that the equation <a class="reference internal" href="#equation-eqn-conv">(48)</a> can be discretized as</p>
<div class="math notranslate nohighlight">
\[\frac{Du}{Dt} = f\;\;\textrm{i.e. }\frac{du}{dt}\left( {X(t),t} \right) = f\left(X( t ),t \right)\textrm{ where }\frac{dX}{dt}( t ) = \mathbf{\alpha}( {X(t),t})\]</div>
<p>where <span class="math notranslate nohighlight">\(D\)</span> is the total derivative operator.
So a good scheme is one step of backward convection by the method of Characteristics-Galerkin</p>
<div class="math notranslate nohighlight" id="equation-eqn-charac">
<span class="eqno">(50)<a class="headerlink" href="#equation-eqn-charac" title="Permalink to this equation">¶</a></span>\[\frac{1}{{\tau }}\left(u^{m + 1}(x) - u^m(X^m(x))\right) = f^m (x)\]</div>
<p>where <span class="math notranslate nohighlight">\(X^m (x)\)</span> is an approximation of the solution at <span class="math notranslate nohighlight">\(t = m\tau\)</span> of the ordinary differential equation</p>
<div class="math notranslate nohighlight">
\[\frac{d\mathbf{X}}{dt}(t) = \mathbf{\alpha}^m(\mathbf{X}(t)), \mathbf{X}((m + 1)\tau) = x.\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{\alpha}^m(x)=(\alpha_1(x,m\tau ),\alpha_2(x,m\tau))\)</span>.
Because, by Taylor’s expansion, we have</p>
<div class="math notranslate nohighlight" id="equation-eqn-conv1">
<span class="eqno">(51)<a class="headerlink" href="#equation-eqn-conv1" title="Permalink to this equation">¶</a></span>\[\begin{split}u^m(\mathbf{X}(m\tau ))&amp;=&amp;
u^m(\mathbf{X}((m+1)\tau )) -
\tau \sum_{i=1}^d \frac{\p u^m}{\p x_i}(\mathbf{X}((m+1)\tau ))
\frac{\p X_i}{\p t}((m+1)\tau )
+o(\tau )\nonumber\\
&amp;=&amp;u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau )\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(X_i(t)\)</span> are the i-th component of <span class="math notranslate nohighlight">\(\mathbf{X}(t)\)</span>, <span class="math notranslate nohighlight">\(u^m(x)=u(x,m\tau )\)</span> and we used the chain rule and <span class="math notranslate nohighlight">\(x=\mathbf{X}((m+1)\tau )\)</span>.
From <a class="reference internal" href="#equation-eqn-conv1">(51)</a>, it follows that</p>
<div class="math notranslate nohighlight">
\[u^m(X^m(x))=u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau )\]</div>
<p>Also we apply Taylor’s expansion for <span class="math notranslate nohighlight">\(t \rightarrow u^m(x-\mathbf{\alpha}^m(x)t),0\le t\le \tau\)</span>, then</p>
<div class="math notranslate nohighlight">
\[u^m(x-\mathbf{\alpha}\tau )=u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau ).\]</div>
<p>Putting</p>
<p><code class="docutils literal highlight highlight-freefem"><span></span>:::freefem convect</code><span class="math notranslate nohighlight">\(\left( {\mathbf{\alpha},-\tau ,u^m } \right)\approx u^m \left(x - \mathbf{\alpha}^m\tau \right)\)</span></p>
<p>we can get the approximation</p>
<p><span class="math notranslate nohighlight">\(u^m \left( {X^m( x )} \right) \approx\)</span> <code class="docutils literal highlight highlight-freefem"><span></span>:::freefem convect</code> <span class="math notranslate nohighlight">\(\left( {[a_1^m ,a_2^m],-\tau ,u^m } \right)\)</span> by <span class="math notranslate nohighlight">\(X^m \approx x \mapsto x- \tau [a_1^m(x) ,a_2^m(x)]\)</span></p>
<p>A classical convection problem is that of the “rotating bell” (quoted from <a class="reference internal" href="#lucquin1998" id="id3">[LUCQUIN1998]</a>, p.16).</p>
<p>Let <span class="math notranslate nohighlight">\(\Omega\)</span> be the unit disk centered at 0, with its center rotating with speed <span class="math notranslate nohighlight">\(\alpha_1 = y,\, \alpha_2 = -x\)</span>.
We consider the problem <a class="reference internal" href="#equation-eqn-conv">(48)</a> with <span class="math notranslate nohighlight">\(f=0\)</span> and the initial condition <span class="math notranslate nohighlight">\(u(x,0)=u^0(x)\)</span>, that is, from <a class="reference internal" href="#equation-eqn-charac">(50)</a></p>
<p><span class="math notranslate nohighlight">\(u^{m + 1}(x) = u^m(X^m(x))\approx\)</span> <code class="docutils literal highlight highlight-freefem"><span></span>:::freefem convect</code><span class="math notranslate nohighlight">\((\mathbf{\alpha},-\tau ,u^m)\)</span></p>
<p>The exact solution is <span class="math notranslate nohighlight">\(u(x, t) = u(\mathbf{X}(t))\)</span> where <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> equals <span class="math notranslate nohighlight">\(x\)</span> rotated around the origin by an angle <span class="math notranslate nohighlight">\(\theta = -t\)</span> (rotate in clockwise).
So, if <span class="math notranslate nohighlight">\(u^0\)</span> in a 3D perspective looks like a bell, then <span class="math notranslate nohighlight">\(u\)</span> will have exactly the same shape, but rotated by the same amount.
The program consists in solving the equation until <span class="math notranslate nohighlight">\(T = 2\pi\)</span>, that is for a full revolution and to compare the final solution with the initial one; they should be equal.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Convect</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
real dt = 0.17;

// Mesh
border C(t=0, 2*pi){x=cos(t); y=sin(t);}
mesh Th = buildmesh(C(70));

// Fespace
fespace Vh(Th, P1);
Vh u0;
Vh a1 = -y, a2 = x; //rotation velocity
Vh u;

// Initialization
u = exp(-10*((x-0.3)^2 +(y-0.3)^2));

// Time loop
real t = 0.;
for (int m = 0; m &lt; 2*pi/dt; m++){
    // Update
    t += dt;
    u0 = u;

    // Convect
    u = convect([a1, a2], -dt, u0); //u^{m+1}=u^m(X^m(x))

    // Plot
    plot(u, cmm=&quot; t=&quot;+t+&quot;, min=&quot;+u[].min+&quot;, max=&quot;+u[].max);
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The scheme <cite>:::freefem convect</cite> is unconditionally stable, then the bell become lower and lower (the maximum of $u^{37}$ is $0.406$ as shown in [Fig. 21](#Fig21)).</p>
</div>
<div class="figure" id="id6">
<img alt="../_images/EvolutionProblem_Convect.png" src="../_images/EvolutionProblem_Convect.png" />
<p class="caption"><span class="caption-number">Fig. 148 </span><span class="caption-text"><span class="math notranslate nohighlight">\($u^0=e^{-10((x-0.3)^2 +(y-0.3)^2)}\)</span></span></p>
</div>
<div class="last figure" id="id7">
<img alt="../_images/EvolutionProblem_Convect2.png" src="../_images/EvolutionProblem_Convect2.png" />
<p class="caption"><span class="caption-number">Fig. 149 </span><span class="caption-text">The bell at <span class="math notranslate nohighlight">\(t=6.29\)</span></span></p>
</div>
</div>
</div>
<div class="section" id="d-black-scholes-equation-for-an-european-put-option">
<h2>2D Black-Scholes equation for an European Put option<a class="headerlink" href="#d-black-scholes-equation-for-an-european-put-option" title="Permalink to this headline">¶</a></h2>
<p>In mathematical finance, an option on two assets is modeled by a Black-Scholes equations in two space variables, (see for example <a class="reference internal" href="#wilmott1995" id="id4">[WILMOTT1995]</a> or <a class="reference internal" href="#achdou2005" id="id5">[ACHDOU2005]</a>).</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;&amp;\p _t u + \frac{{\left( {\sigma _1 x } \right)^2 }}{2}\frac{{\p ^2 u}}{{\p x^2 }} + \frac{{\left( {\sigma _2 y } \right)^2 }}{2}\frac{{\p ^2 u}}{{\p y^2 }} \\
&amp;&amp;{\rm{ }} + \rho x y \frac{{\p ^2 u}}{{\p x \p y }} + rS_1 \frac{{\p u}}{{\p x }} + rS_2 \frac{{\p u}}{{\p y }} - rP = 0 \nonumber\end{split}\]</div>
<p>which is to be integrated in <span class="math notranslate nohighlight">\(\left( {0,T} \right) \times \R^ + \times \R^ +\)</span> subject to, in the case of a put</p>
<div class="math notranslate nohighlight">
\[u\left( {x , y ,T} \right) = \left( {K - \max \left( {x ,y } \right)} \right)^+\]</div>
<p>Boundary conditions for this problem may not be so easy to device.
As in the one dimensional case the PDE contains boundary conditions on the axis <span class="math notranslate nohighlight">\(x_1 = 0\)</span> and on the axis <span class="math notranslate nohighlight">\(x_2 = 0\)</span>, namely two one dimensional Black-Scholes equations driven respectively by the data <span class="math notranslate nohighlight">\(u\left( {0, + \infty ,T} \right)\)</span> and <span class="math notranslate nohighlight">\(u\left( { + \infty ,0,T} \right)\)</span>.
These will be automatically accounted for because they are embedded in the PDE.
So if we do nothing in the variational form (i.e.&nbsp;if we take a Neumann boundary condition at these two axis in the strong form) there will be no disturbance to these.
At infinity in one of the variable, as in 1D, it makes sense to impose <span class="math notranslate nohighlight">\(u=0\)</span>.
We take</p>
<div class="math notranslate nohighlight">
\[\sigma _1  = 0.3,\;\;\sigma _2  = 0.3,\;\;\rho  = 0.3,\;\;r = 0.05,\;\;K = 40,\;\;T = 0.5\]</div>
<p>An implicit Euler scheme is used and a mesh adaptation is done every 10 time steps.
To have an unconditionally stable scheme, the first order terms are treated by the Characteristic Galerkin method, which, roughly, approximates</p>
<div class="math notranslate nohighlight">
\[\frac{{\p u}}{{\p t}} + a_1 \frac{{\p u}}{{\p x}} + a_2 \frac{{\p u}}{{\p y}} \approx \frac{1}{{\tau }}\left( {u^{n + 1} \left( x \right) - u^n \left( {x - \mathbf{\alpha}\tau } \right)} \right)\]</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Black-Scholes</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Parameters
int m = 30; int L = 80; int LL = 80; int j = 100; real sigx = 0.3; real sigy = 0.3; real rho = 0.3; real r = 0.05; real K = 40; real dt = 0.01;

// Mesh
mesh th = square(m, m, [L*x, LL*y]);

// Fespace
fespace Vh(th, P1);
Vh u = max(K-max(x,y),0.);
Vh xveloc, yveloc, v, uold;

// Time loop
for (int n = 0; n*dt &lt;= 1.0; n++){
    // Mesh adaptation
    if (j &gt; 20){
        th = adaptmesh(th, u, verbosity=1, abserror=1, nbjacoby=2,
            err=0.001, nbvx=5000, omega=1.8, ratio=1.8, nbsmooth=3,
            splitpbedge=1, maxsubdiv=5, rescaling=1);
        j = 0;
        xveloc = -x*r + x*sigx^2 + x*rho*sigx*sigy/2;
        yveloc = -y*r + y*sigy^2 + y*rho*sigx*sigy/2;
        u = u;
    }

    // Update
    uold = u;

    // Solve
    solve eq1(u, v, init=j, solver=LU)
        = int2d(th)(
              u*v*(r+1/dt)
            + dx(u)*dx(v)*(x*sigx)^2/2
            + dy(u)*dy(v)*(y*sigy)^2/2
            + (dy(u)*dx(v) + dx(u)*dy(v))*rho*sigx*sigy*x*y/2
        )
        - int2d(th)(
              v*convect([xveloc, yveloc], dt, uold)/dt
        )
        + on(2, 3, u=0)
        ;

    // Update
    j = j+1;
};

// Plot
plot(u, wait=true, value=true);
</pre></div>
</div>
<p>Results are shown on <a class="reference internal" href="#figevolutionblacksholes1"><span class="std std-numref">Fig. 150</span></a> and <a class="reference internal" href="#figevolutionblacksholes2"><span class="std std-numref">Fig. 151</span></a>.</p>
<div class="figure" id="figevolutionblacksholes1">
<img alt="../_images/EvolutionProblems_BlackSholes.png" src="../_images/EvolutionProblems_BlackSholes.png" />
<p class="caption"><span class="caption-number">Fig. 150 </span><span class="caption-text">The adapted triangulation</span></p>
</div>
<div class="last figure" id="figevolutionblacksholes2">
<img alt="../_images/EvolutionProblems_BlackSholes2.png" src="../_images/EvolutionProblems_BlackSholes2.png" />
<p class="caption"><span class="caption-number">Fig. 151 </span><span class="caption-text">The level line of the European basquet put option</span></p>
</div>
</div>
<table class="docutils citation" frame="void" id="tabata1994" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[TABATA1994]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> TABATA, M. Numerical solutions of partial differential equations II. Iwanami Applied Math, 1994.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="lucquin1998" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[LUCQUIN1998]</a></td><td>PIRONNEAU, O. et LUCQUIN-DESREUX, B. Introduction to scientific computing. Wiley, 1998.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="wilmott1995" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[WILMOTT1995]</a></td><td>WILMOTT, Paul, HOWISON, Sam, et DEWYNNE, Jeff. A student introduction to mathematical finance. 1995.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="achdou2005" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[ACHDOU2005]</a></td><td>ACHDOU, Yves et PIRONNEAU, Olivier. Computational methods for option pricing. Siam, 2005.</td></tr>
</tbody>
</table>
</div>
</div>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
<div class="localtoc">
    <p class="caption">
      <span class="caption-text">Table Of Contents</span>
    </p>
    <ul>
<li><a class="reference internal" href="#">Evolution problems</a><ul>
<li><a class="reference internal" href="#mathematical-theory-on-time-difference-approximations">Mathematical Theory on Time Difference Approximations.</a></li>
<li><a class="reference internal" href="#convection">Convection</a></li>
<li><a class="reference internal" href="#d-black-scholes-equation-for-an-european-put-option">2D Black-Scholes equation for an European Put option</a></li>
</ul>
</li>
</ul>

</div>
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="eigenValueProblems.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Eigen value problems</div>
         </div>
     </a>
     <a id="button-next" href="navierStokesEquations.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>Navier-Stokes equations</div>
        </div>
     </a>
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FreeFem++</div>
      <div>
        
        <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Mathematical Models</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2018, FreeFem++.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.3 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>