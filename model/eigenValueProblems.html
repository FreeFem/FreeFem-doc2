<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Eigen value problems</title>
		<link rel="icon" href="../_static/img/favicon.png">

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

		<!-- FreeFem++ theme specific -->
		<link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

		<!-- css -->
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

		<!-- js -->
		<script src="../_static/nav.json"></script>
		<script src="../_static/js/nav.js"></script>
		<script src="../_static/js/common.js"></script>

		<!-- MathJax -->
		<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
			<div class="header-logo">
    <div>
        <a href="../introduction/introduction.html">
            <img alt="logo" title="FreeFem++ documentation" src="../_static/img/Logo.png" />
        </a>
    </div>
</div>
<div class="header-title">
    <div>
        <a href="../introduction/introduction.html">
            <h2>FreeFem++ documentation</h2>
        </a>
    </div>
</div>
<div class="header-github">
    <a href="https://github.com/FreeFem/FreeFem-sources">
        <div class="header-github-img">
            <img alt="GitHub" title="FreeFem++ on GitHub" src="../_static/img/GitHub-Mark-120px-plus.png" />
        </div>
        <div class="header-github-title">
            <div class="header-github-title-text">
                FreeFem++ on GitHub
            </div>
            <div class="header-github-title-stars">
                <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
            </div>
        </div>
    </a>
</div>
<script src="../_static/js/github.js"></script>
		</header>
		
		<nav>
			<script>nav("../")</script>
			<div class="search">
				<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr_index.js"></script>

<script src="../_static/js/search.js"></script>

<div class="search">
    <input type="search" id="searchInput" placeholder="Search..." oninput="search(this.value);" />
    <div class="searchResults">
        <div id="resultCount">
        </div>
        <div id="searchResults">
        </div>
    </div>
</div>
			</div>
		</nav>
		

		
		<div class="container">
			<div class="toc" id="toc">
				<div>
					<ul>
<li><a class="reference internal" href="#">Eigen value problems</a></li>
</ul>

				</div>
			</div>
			<div class="content">
				<div>
					
    <div class="section" id="eigen-value-problems">
<h1>Eigen value problems<a class="headerlink" href="#eigen-value-problems" title="Permalink to this headline">Â¶</a></h1>
<p>This section depends on your installation of FreeFem++; you need to have compiled <code class="docutils literal highlight highlight-default"><span></span><span class="n">ARPACK</span></code>.
This tool is available in FreeFem++ if the word eigenvalue appears in line <code class="docutils literal highlight highlight-default"><span></span><span class="n">Load</span><span class="p">:</span></code>, like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-- FreeFem++ v*.** <span class="o">(</span>date *** *** ** **:**:** CET ****<span class="o">)</span>
 file : ***.edp
 Load: lg_fem lg_mesh eigenvalue
</pre></div>
</div>
<p>This tool is based on <a class="reference external" href="http://www.caam.rice.edu/software/ARPACK/">arpack++</a>, the object-oriented version of <code class="docutils literal highlight highlight-default"><span></span><span class="n">ARPACK</span></code> eigenvalue package <a class="reference internal" href="../reference.html#lehoucq1998" id="id1">[LEHOUCQ1998]</a>.</p>
<p>The function <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">EigenValue</span></code> computes the generalized eigenvalue of <span class="math notranslate nohighlight">\(A u = \lambda B u\)</span>.
The Shift-invert method is used by default, with sigma =<span class="math notranslate nohighlight">\(\sigma\)</span> the shift of the method.</p>
<p>The matrix <span class="math notranslate nohighlight">\(OP\)</span> is defined with <span class="math notranslate nohighlight">\(A - \sigma B\)</span>.</p>
<p>The return value is the number of converged eigenvalues (can be greater than the number of requested eigenvalues nev=)</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="nf">EigenValue</span><span class="p">(</span><span class="n">OP</span><span class="p">,</span> <span class="kp">B</span><span class="p">,</span> <span class="kp">nev</span><span class="o">=</span><span class="n">Nev</span><span class="p">,</span> <span class="kp">sigma</span><span class="o">=</span><span class="n">Sigma</span><span class="p">);</span>
</pre></div>
</div>
<p>where the matrix <span class="math notranslate nohighlight">\(OP= A - \sigma B\)</span> with a solver and boundary condition, and the matrix <span class="math notranslate nohighlight">\(B\)</span>.</p>
<p>There is also a functional interface:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="nf">EigenValue</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="n">FOP1</span><span class="p">,</span> <span class="n">FB</span><span class="p">,</span> <span class="kp">nev</span><span class="o">=</span><span class="n">Nev</span><span class="p">,</span> <span class="kp">sigma</span><span class="o">=</span><span class="n">Sigma</span><span class="p">);</span>
</pre></div>
</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the size of the problem, and the operators are now defined through functions, defining respectively the matrix product of <span class="math notranslate nohighlight">\(OP^{-1}\)</span> and <span class="math notranslate nohighlight">\(B\)</span>, as in</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="n">OP1</span><span class="p">.</span><span class="kr">n</span><span class="p">;</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">FOP1</span><span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">u</span><span class="p">){</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Au</span> <span class="o">=</span> <span class="n">OP</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="p">;</span> <span class="k">return</span> <span class="n">Au</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">FB</span><span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">u</span><span class="p">){</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Au</span> <span class="o">=</span> <span class="kp">B</span><span class="o">*</span><span class="n">u</span><span class="p">;</span> <span class="k">return</span> <span class="n">Au</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>If you want finer control over the method employed in <code class="docutils literal highlight highlight-default"><span></span><span class="n">ARPACK</span></code>, you can specify which mode <code class="docutils literal highlight highlight-default"><span></span><span class="n">ARPACK</span></code> will work with (<code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">mode</span><span class="o">=</span></code> , see ARPACK documentation <a class="reference internal" href="../reference.html#lehoucq1998" id="id2">[LEHOUCQ1998]</a>). The operators necessary for the chosen mode can be passed through the optional parameters <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">A</span><span class="o">=</span></code>, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">A1</span><span class="o">=</span></code>, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">B</span><span class="o">=</span></code>, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">B1</span><span class="o">=</span></code>, (see below).</p>
<ul>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">mode</span><span class="o">=</span><span class="mi">1</span></code>: Regular mode for solving <span class="math notranslate nohighlight">\(A u = \lambda u\)</span></p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="nf">EigenValue</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="kp">A</span><span class="o">=</span><span class="n">FOP</span><span class="p">,</span> <span class="kp">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nev</span><span class="o">=</span><span class="n">Nev</span><span class="p">);</span>
</pre></div>
</div>
<p>where the function FOP defines the matrix product of A</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">mode</span><span class="o">=</span><span class="mi">2</span></code>: Regular inverse mode for solving <span class="math notranslate nohighlight">\(A u = \lambda B u\)</span></p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="nf">EigenValue</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="kp">A</span><span class="o">=</span><span class="n">FOP</span><span class="p">,</span> <span class="kp">B</span><span class="o">=</span><span class="n">FB</span><span class="p">,</span> <span class="kp">B1</span><span class="o">=</span><span class="n">FB1</span><span class="p">,</span> <span class="kp">mode</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="kp">nev</span><span class="o">=</span><span class="n">Nev</span><span class="p">);</span>
</pre></div>
</div>
<p>where the functions FOP, FB and FB1 define respectively the matrix product of <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(B\)</span> and <span class="math notranslate nohighlight">\(B^{-1}\)</span></p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">mode</span><span class="o">=</span><span class="mi">3</span></code>: Shift-invert mode for solving <span class="math notranslate nohighlight">\(A u = \lambda B u\)</span></p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="nf">EigenValue</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="kp">A1</span><span class="o">=</span><span class="n">FOP1</span><span class="p">,</span> <span class="kp">B</span><span class="o">=</span><span class="n">FB</span><span class="p">,</span> <span class="kp">mode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="kp">sigma</span><span class="o">=</span><span class="n">Sigma</span><span class="p">,</span> <span class="kp">nev</span><span class="o">=</span><span class="n">Nev</span><span class="p">);</span>
</pre></div>
</div>
<p>where the functions FOP1 and FB define respectively the matrix product of <span class="math notranslate nohighlight">\(OP^{-1} = (A - \sigma B)^{-1}\)</span> and <span class="math notranslate nohighlight">\(B\)</span></p>
</li>
</ul>
<p>You can also specify which subset of eigenvalues you want to compute (<code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">which</span><span class="o">=</span></code>).
The default value is <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">which</span><span class="o">=</span><span class="s">&quot;LM&quot;</span></code>, for eigenvalues with largest magnitude.
<code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="s">&quot;SM&quot;</span></code> is for smallest magnitude, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="s">&quot;LA&quot;</span></code> for largest algebraic value, <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="s">&quot;SA&quot;</span></code> for smallest algebraic value, and <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="s">&quot;BE&quot;</span></code> for both ends of the spectrum.</p>
<p>Remark: For complex problems, you need to use the keyword <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">complexEigenValue</span></code> instead of <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">EigenValue</span></code> when passing operators through functions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Boundary condition and Eigenvalue Problems</p>
<p>The locking (Dirichlet) boundary condition is make with exact penalization so we put <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="mf">1e30</span><span class="o">=</span><span class="kp">tgv</span></code> on the diagonal term of the locked degree of freedom (see <a class="reference internal" href="../documentation/finiteElement.html#variationalformsparsematrixpde"><span class="std std-ref">Finite element chapter</span></a>). So take Dirichlet boundary condition just on <span class="math notranslate nohighlight">\(A\)</span> and not on <span class="math notranslate nohighlight">\(B\)</span> because we solve <span class="math notranslate nohighlight">\(w=OP^{-1}*B*v\)</span>.</p>
<p class="last">If you put locking (Dirichlet) boundary condition on <span class="math notranslate nohighlight">\(B\)</span> matrix (with key work <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">on</span></code>) you get small spurious modes <span class="math notranslate nohighlight">\((10^{-30})\)</span>, due to boundary condition, but if you forget the locking boundary condition on <span class="math notranslate nohighlight">\(B\)</span> matrix (no keywork <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">on</span></code>) you get huge spurious <span class="math notranslate nohighlight">\((10^{30})\)</span> modes associated to these boundary conditons. We compute only small mode, so we get the good one in this case.</p>
</div>
<ul>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">sym</span><span class="o">=</span></code> The problem is symmetric (all the eigen value are real)</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">nev</span><span class="o">=</span></code> The number desired eigenvalues (nev) close to the shift.</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">value</span><span class="o">=</span></code> The array to store the real part of the eigenvalues</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">ivalue</span><span class="o">=</span></code> The array to store the imaginary part of the eigenvalues</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">vector</span><span class="o">=</span></code> The FE function array to store the eigenvectors</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">rawvector</span><span class="o">=</span></code> An array of type <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">]</span></code> to store eigenvectors by column.</p>
<p>For real non symmetric problems, complex eigenvectors are given as two consecutive vectors, so if eigenvalue <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(k+1\)</span> are complex conjugate eigenvalues, the <span class="math notranslate nohighlight">\(k\)</span>th vector will contain the real part and the <span class="math notranslate nohighlight">\(k+1\)</span>th vector the imaginary part of the corresponding complex conjugate eigenvectors.</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">tol</span><span class="o">=</span></code> The relative accuracy to which eigenvalues are to be determined;</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">sigma</span><span class="o">=</span></code> The shift value;</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">maxit</span><span class="o">=</span></code> The maximum number of iterations allowed;</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">ncv</span><span class="o">=</span></code> The number of Arnoldi vectors generated at each iteration of <code class="docutils literal highlight highlight-default"><span></span><span class="n">ARPACK</span></code>;</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">mode</span><span class="o">=</span></code> The computational mode used by <code class="docutils literal highlight highlight-default"><span></span><span class="n">ARPACK</span></code> (see above);</p>
</li>
<li><p class="first"><code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">which</span><span class="o">=</span></code> The requested subset of eigenvalues (see above).</p>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Laplace eigenvalue</p>
<p>In the first example, we compute the eigenvalues and the eigenvectors of the Dirichlet problem on square <span class="math notranslate nohighlight">\(\Omega=]0,\pi[^2\)</span>.</p>
<p>The problem is to find: <span class="math notranslate nohighlight">\(\lambda\)</span>, and <span class="math notranslate nohighlight">\(\nabla u_{\lambda}\)</span> in <span class="math notranslate nohighlight">\(\mathbb{R}{\times} H^1_0(\Omega)\)</span></p>
<div class="math notranslate nohighlight">
\[\int_\Omega \nabla u_{\lambda} \nabla v = \lambda \int_\Omega u v \quad \forall v \in H^1_0(\Omega)\]</div>
<p>The exact eigenvalues are <span class="math notranslate nohighlight">\(\lambda_{n,m} =(n^2+m^2), (n,m)\in {\mathbb{N}_*}^2\)</span> with the associated eigenvectors are <span class="math notranslate nohighlight">\(u_{{m,n}}=\sin(nx)*\sin(my)\)</span>.</p>
<p>We use the generalized inverse shift mode of the <cite>arpack++</cite> library, to find 20 eigenvalues and eigenvectors close to the shift value <span class="math notranslate nohighlight">\(\sigma=20\)</span>.</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span><span class="c1">// Parameters</span>
<span class="kr">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">sigma</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">//value of the shift</span>
<span class="kt">int</span> <span class="kp">nev</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">//number of computed eigen value close to sigma</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="kr">pi</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="kr">pi</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="c1">// OP = A - sigma B ; // the shifted matrix</span>
<span class="kt">varf</span> <span class="kp">op</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
        <span class="o">-</span> <span class="kp">sigma</span><span class="o">*</span> <span class="n">u1</span><span class="o">*</span><span class="n">u2</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">b</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">u2</span><span class="p">])</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">u1</span><span class="o">*</span><span class="n">u2</span><span class="p">);</span> <span class="c1">//no boundary condition</span>

<span class="kt">matrix</span> <span class="n">OP</span> <span class="o">=</span> <span class="kp">op</span><span class="p">(</span><span class="n">Vh</span><span class="p">,</span> <span class="n">Vh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">Crout</span><span class="p">,</span> <span class="kp">factorize</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//crout solver because the matrix in not positive</span>
<span class="kt">matrix</span> <span class="kp">B</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">Vh</span><span class="p">,</span> <span class="n">Vh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">,</span> <span class="kp">eps</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">);</span>

<span class="c1">// important remark:</span>
<span class="c1">// the boundary condition is make with exact penalization:</span>
<span class="c1">// we put 1e30=tgv on the diagonal term of the lock degree of freedom.</span>
<span class="c1">// So take Dirichlet boundary condition just on $a$ variational form</span>
<span class="c1">// and not on $b$ variational form.</span>
<span class="c1">// because we solve $ w=OP^-1*B*v $</span>

<span class="c1">// Solve</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">ev</span><span class="p">(</span><span class="kp">nev</span><span class="p">);</span> <span class="c1">//to store the nev eigenvalue</span>
<span class="n">Vh</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">eV</span><span class="p">(</span><span class="kp">nev</span><span class="p">);</span> <span class="c1">//to store the nev eigenvector</span>

<span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="nf">EigenValue</span><span class="p">(</span><span class="n">OP</span><span class="p">,</span> <span class="kp">B</span><span class="p">,</span> <span class="kp">sym</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">sigma</span><span class="o">=</span><span class="kp">sigma</span><span class="p">,</span> <span class="kp">value</span><span class="o">=</span><span class="n">ev</span><span class="p">,</span> <span class="kp">vector</span><span class="o">=</span><span class="n">eV</span><span class="p">,</span>
    <span class="kp">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="kp">maxit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kp">ncv</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Display &amp; Plot</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">eV</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="kt">real</span> <span class="n">gg</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">));</span>
    <span class="kt">real</span> <span class="n">mm</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">u1</span><span class="o">*</span><span class="n">u1</span><span class="p">)</span> <span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;lambda[&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;] = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ev</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, err= &quot;</span> <span class="o">&lt;&lt;</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">u1</span><span class="o">*</span><span class="n">u1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">eV</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;Eigen Vector &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">&quot; value =&quot;</span><span class="o">+</span><span class="n">ev</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">value</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The output of this example is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lambda<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>.0002, <span class="nv">err</span><span class="o">=</span> -1.46519e-11
lambda<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">8</span>.00074, <span class="nv">err</span><span class="o">=</span> -4.05158e-11
lambda<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">10</span>.0011, <span class="nv">err</span><span class="o">=</span> <span class="m">2</span>.84925e-12
lambda<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">10</span>.0011, <span class="nv">err</span><span class="o">=</span> -7.25456e-12
lambda<span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">=</span> <span class="m">13</span>.002, <span class="nv">err</span><span class="o">=</span> -1.74257e-10
lambda<span class="o">[</span><span class="m">5</span><span class="o">]</span> <span class="o">=</span> <span class="m">13</span>.0039, <span class="nv">err</span><span class="o">=</span> <span class="m">1</span>.22554e-11
lambda<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">17</span>.0046, <span class="nv">err</span><span class="o">=</span> -1.06274e-11
lambda<span class="o">[</span><span class="m">7</span><span class="o">]</span> <span class="o">=</span> <span class="m">17</span>.0048, <span class="nv">err</span><span class="o">=</span> <span class="m">1</span>.03883e-10
lambda<span class="o">[</span><span class="m">8</span><span class="o">]</span> <span class="o">=</span> <span class="m">18</span>.0083, <span class="nv">err</span><span class="o">=</span> -4.05497e-11
lambda<span class="o">[</span><span class="m">9</span><span class="o">]</span> <span class="o">=</span> <span class="m">20</span>.0096, <span class="nv">err</span><span class="o">=</span> -2.21678e-13
lambda<span class="o">[</span><span class="m">10</span><span class="o">]</span> <span class="o">=</span> <span class="m">20</span>.0096, <span class="nv">err</span><span class="o">=</span> -4.16212e-14
lambda<span class="o">[</span><span class="m">11</span><span class="o">]</span> <span class="o">=</span> <span class="m">25</span>.014, <span class="nv">err</span><span class="o">=</span> -7.42931e-10
lambda<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">25</span>.0283, <span class="nv">err</span><span class="o">=</span> <span class="m">6</span>.77444e-10
lambda<span class="o">[</span><span class="m">13</span><span class="o">]</span> <span class="o">=</span> <span class="m">26</span>.0159, <span class="nv">err</span><span class="o">=</span> <span class="m">3</span>.19864e-11
lambda<span class="o">[</span><span class="m">14</span><span class="o">]</span> <span class="o">=</span> <span class="m">26</span>.0159, <span class="nv">err</span><span class="o">=</span> -4.9652e-12
lambda<span class="o">[</span><span class="m">15</span><span class="o">]</span> <span class="o">=</span> <span class="m">29</span>.0258, <span class="nv">err</span><span class="o">=</span> -9.99573e-11
lambda<span class="o">[</span><span class="m">16</span><span class="o">]</span> <span class="o">=</span> <span class="m">29</span>.0273, <span class="nv">err</span><span class="o">=</span> <span class="m">1</span>.38242e-10
lambda<span class="o">[</span><span class="m">17</span><span class="o">]</span> <span class="o">=</span> <span class="m">32</span>.0449, <span class="nv">err</span><span class="o">=</span> <span class="m">1</span>.2522e-10
lambda<span class="o">[</span><span class="m">18</span><span class="o">]</span> <span class="o">=</span> <span class="m">34</span>.049, <span class="nv">err</span><span class="o">=</span> <span class="m">3</span>.40213e-11
lambda<span class="o">[</span><span class="m">19</span><span class="o">]</span> <span class="o">=</span> <span class="m">34</span>.0492, <span class="nv">err</span><span class="o">=</span> <span class="m">2</span>.41751e-10
</pre></div>
</div>
<div class="inline2 figure" id="id3">
<img alt="../_images/EigenValueProblems1.png" src="../_images/EigenValueProblems1.png" />
<p class="caption"><span class="caption-number">Fig. 201 </span><span class="caption-text">Isovalue of 11th eigenvector <span class="math notranslate nohighlight">\(u_{4,3}-u_{3,4}\)</span></span></p>
</div>
<div class="inline2 last figure" id="id4">
<img alt="../_images/EigenValueProblems2.png" src="../_images/EigenValueProblems2.png" />
<p class="caption"><span class="caption-number">Fig. 202 </span><span class="caption-text">Isovalue of 12th eigenvector <span class="math notranslate nohighlight">\(u_{4,3}+u_{3,4}\)</span></span></p>
</div>
</div>
</div>


				</div>
			</div>
		</div>
		
		<footer>
			<script>
    let date = new Date()
    let currentYear = date.getFullYear()
</script>
<div class="footer-text">
    <a href="https://freefem.org/">FreeFem++</a> 1987-<script>document.write(currentYear)</script>
</div>
<div class="footer-img">
    <p>
        Made with <i class="fas fa-heart"></i> on
    </p>
    <span class="separator"></span>
    <a href="https://github.com/FreeFem">
        <img alt="Github" title="Github" src="../_static/img/GitHub_Logo_White.png" />
    </a>
</div>
		</footer>
		

		<script src="../_static/js/toc.js"></script>
	</body>
</html>