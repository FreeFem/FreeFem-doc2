<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>Navier-Stokes equations &#8212; FreeFem++ 3.61.2 documentation</title>

    <link rel="stylesheet" href="../_static/material-icons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/notosanscjkjp.css" />
    <link rel="stylesheet" type="text/css" href="../_static/roboto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material-design-lite-1.3.0/material.indigo-pink.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_materialdesign_theme.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/sphinx_materialdesign_theme.js"></script>
    <link rel="canonical" href="doc.freefem.org/dev/model/navierStokesEquations.html" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Variational Inequality" href="variationalInequality.html" />
    <link rel="prev" title="Evolution problems" href="evolutionProblems.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link" href="index.html">Mathematical Models</a><i class="material-icons">navigate_next</i>
            <a class="mdl-navigation__link is-active">Navier-Stokes equations</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="../search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
<a id="button-show-source"
    class="mdl-button mdl-js-button mdl-button--icon"
    href="../_sources/model/navierStokesEquations.rst.txt" rel="nofollow">
<i class="material-icons">code</i>
</a>
<div class="mdl-tooltip" data-mdl-for="button-show-source">
Show Source
</div>
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/rotatingHill.html">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/aLargeFluidProblem.html">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Mathematical Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="evolutionProblems.html">Evolution problems</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../index.html">
              <span class="title-text">
                  FreeFem++
              </span>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFem++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/globalVariables.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/quadratureFormulae.html">Quadrature formulae</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/IO.html">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/externalLibraries.html">External libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/poisson.html">Solving Poisson’s equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/equationsClassification.html">Classification of partial differential equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/membrane.html">Membrane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatExchanger.html">Heat Exchanger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/acoustics.html">Acoustics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/thermalConduction.html">Thermal Conduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/fanBlade.html">Irrotational Fan Blade Flow and Thermal effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/rotatingHill.html">Pure Convection : The Rotating Hill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/elasticity.html">The System of elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/stokes.html">The System of Stokes for Fluids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesProjection.html">A projection algorithm for the Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/navierStokesNewton.html">Newton Method for the Steady Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/aLargeFluidProblem.html">A Large Fluid Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/complexNumbers.html">An Example with Complex Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/optimalControl.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/flowWithShocks.html">A Flow with Shocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/heatEquationOptimization.html">Time dependent schema optimization for heat equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/timeDependentStokes.html">Tutorial to write a transient Stokes solver in matrix form</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/wifiPropagation.html">Wifi Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/matlabOctavePlot.html">Plotting in Matlab and Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Mathematical Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">Mathematical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticProblems.html">Static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="elasticity.html">Elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearStaticProblems.html">Non-linear static problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="eigenValueProblems.html">Eigen value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="evolutionProblems.html">Evolution problems</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Navier-Stokes equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="variationalInequality.html">Variational Inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="domainDecomposition.html">Domain decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluidStructureCoupledProblem.html">Fluid-structure coupled problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="transmissionProblem.html">Transmission problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="freeBoundaryProblem.html">Free boundary problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonLinearElasticity.html">Non-linear elasticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressibleNeoHookeanMaterials.html">Compressible Neo-Hookean materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="whisperingGalleryModes.html">Whispering gallery modes</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <div class="section" id="navier-stokes-equations">
<h1>Navier-Stokes equations<a class="headerlink" href="#navier-stokes-equations" title="Permalink to this headline">¶</a></h1>
<p>The Stokes equations are: for a given
<span class="math notranslate nohighlight">\(\mathbf{f}\in L^2(\Omega)^2\)</span>,</p>
<dl class="docutils">
<dt>:raw-latex:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{equation}</dt>
<dd><dl class="first docutils">
<dt>left.begin{array}{cl}</dt>
<dd>label{eqn::Stokes}
-Delta mathbf{u}+nabla p &amp; =mathbf{f} \
nablacdot mathbf{u} &amp;=0</dd>
</dl>
<p class="last">end{array}right}quad hbox{ in }Omega</p>
</dd>
</dl>
<p>end{equation}`</p>
<p>where <span class="math notranslate nohighlight">\(\mathbf{u}=(u_1,u_2)\)</span> is the velocity vector and <span class="math notranslate nohighlight">\(p\)</span>
the pressure. For simplicity, let us choose Dirichlet boundary
conditions on the velocity, <span class="math notranslate nohighlight">\(\mathbf{u}=\mathbf{u}_{\Gamma}\)</span> on
<span class="math notranslate nohighlight">\(\Gamma\)</span>.</p>
<p>In <a class="reference external" href="#TEMAM1977">TEMAM1977</a>, Theorem 2.2, there is a weak form of
<a href="#id3"><span class="problematic" id="id4">:raw-latex:`\eqref{eqn::Stokes}`</span></a>:</p>
<p>Find <span class="math notranslate nohighlight">\(\mathbf{v}=(v_1,v_2)\in \mathbf{V}(\Omega)\)</span></p>
<div class="math notranslate nohighlight">
\[\mathbf{V}(\Omega)=\{\mathbf{w}\in H^1_0(\Omega)^2|\; \textrm{div}\mathbf{w}=0\}\]</div>
<p>which satisfy</p>
<div class="math notranslate nohighlight">
\[\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i=\int_{\Omega}\mathbf{f}\cdot \mathbf{w}
\quad \textrm{for all }v\in V\]</div>
<p>Here it is used the existence <span class="math notranslate nohighlight">\(p\in H^1(\Omega)\)</span> such that
<span class="math notranslate nohighlight">\(\mathbf{u}=\nabla p\)</span>, if</p>
<div class="math notranslate nohighlight">
\[\int_{\Omega}\mathbf{u}\cdot \mathbf{v}=0\quad \textrm{for all }\mathbf{v}\in
V\]</div>
<p>Another weak form is derived as follows: We put</p>
<p><a href="#id5"><span class="problematic" id="id6">:raw-latex:`\begin{eqnarray*}
\mathbf{V}=H^1_0(\Omega)^2;\quad
W=\left\{q\in L^2(\Omega)\left|\; \int_{\Omega}q=0\right.\right\}
\end{eqnarray*}`</span></a></p>
<p>By multiplying the first equation in <a href="#id7"><span class="problematic" id="id8">:raw-latex:`\eqref{eqn::Stokes}`</span></a>
with <span class="math notranslate nohighlight">\(v\in V\)</span> and the second with <span class="math notranslate nohighlight">\(q\in W\)</span>, subsequent
integration over <span class="math notranslate nohighlight">\(\Omega\)</span>, and an application of Green’s formula,
we have</p>
<p><a href="#id9"><span class="problematic" id="id10">:raw-latex:`\begin{eqnarray*}
\int_{\Omega}\nabla\mathbf{u}\cdot \nabla\mathbf{v}-\int_{\Omega}\textrm{div}\mathbf{v}\, p
&amp;=&amp;\int_{\Omega}\mathbf{f}\cdot\mathbf{v}\\
\int_{\Omega}\textrm{div}\mathbf{u}\, q&amp;=&amp;0
\end{eqnarray*}`</span></a></p>
<p>This yields the weak form of <a href="#id11"><span class="problematic" id="id12">:raw-latex:`\eqref{eqn::Stokes}`</span></a>:</p>
<p>Find <span class="math notranslate nohighlight">\((\mathbf{u},p)\in \mathbf{V}\times W\)</span> such that</p>
<p><a href="#id13"><span class="problematic" id="id14">:raw-latex:`\begin{eqnarray}
a(\mathbf{u},\mathbf{v})+b(\mathbf{v},p)&amp;=&amp;(\mathbf{f},\mathbf{v})\\
b(\mathbf{u},q)&amp;=&amp;0
\end{eqnarray}`</span></a></p>
<p>for all <span class="math notranslate nohighlight">\((\mathbf{v},q)\in V\times W\)</span>, where</p>
<p><a href="#id15"><span class="problematic" id="id16">:raw-latex:`\begin{eqnarray}
a(\mathbf{u},\mathbf{v})&amp;=&amp;\int_{\Omega}\nabla \mathbf{u}\cdot \nabla\mathbf{v}
=\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i\\
b(\mathbf{u},q)&amp;=&amp;-\int_{\Omega}\textrm{div}\mathbf{u}\, q
\end{eqnarray}`</span></a></p>
<p>Now, we consider finite element spaces
<span class="math notranslate nohighlight">\(\mathbf{V}_h\subset \mathbf{V}\)</span> and <span class="math notranslate nohighlight">\(W_h\subset W\)</span>, and we
assume the following basis functions</p>
<p><a href="#id17"><span class="problematic" id="id18">:raw-latex:`\begin{eqnarray*}
&amp;&amp;\mathbf{V}_h=V_h\times V_h,\quad
V_h=\{v_h|\; v_h=v_1\phi_1+\cdots +v_{M_V}\phi_{M_V}\},\\
&amp;&amp;W_h=\{q_h|\; q_h=q_1\varphi_1+\cdots +q_{M_W}\varphi_{M_W}\}
\end{eqnarray*}`</span></a></p>
<p>The discrete weak form is: Find
<span class="math notranslate nohighlight">\((\mathbf{u}_{h},p_{h}) \in \mathbf{V}_{h} \times W_{h}\)</span> such that</p>
<dl class="docutils">
<dt>:raw-latex:<a href="#id19"><span class="problematic" id="id20">`</span></a>begin{equation}</dt>
<dd>label{eqn::vfStokes}
begin{array}{cll}
a(mathbf{u}_h,mathbf{v}_h)+b(mathbf{v}_h,p) &amp;= (mathbf{f},mathbf{v}_h) ,
&amp;forall mathbf{v}_{h} in mathbf{V}_{h} \
b(mathbf{u}_h,q_h)&amp;= 0,
&amp;forall q_{h} in W_{h}
end{array}</dd>
</dl>
<p>end{equation}`</p>
<p>!!! note Assume that:</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>1. There is a constant $\alpha_h&gt;0$ such that

    $$
    a(\mathbf{v}_h,\mathbf{v}_h)\ge \alpha\| \mathbf{v}_h\|_{1,\Omega}^2\quad \textrm{for all }\mathbf{v}_h\in Z_h
    $$

    &lt;!--- __ ---&gt;

    where

    $$
    Z_h=\{\mathbf{v}_h\in \mathbf{V}_h|\; b(\mathbf{w}_h,q_h)=0\quad \textrm{for all }q_h\in W_h\}
    $$

2. There is a constant $\beta_h&gt;0$ such that

    $$
    \sup_{\mathbf{v}_h\in \mathbf{V}_h}\frac{b(\mathbf{v}_h,q_h)}{\| \mathbf{v}_h\|_{1,\Omega}}
    \ge \beta_h\| q_h\|_{0,\Omega}\quad \textrm{for all }q_h\in W_h
    $$

Then we have an unique solution $(\mathbf{u}_h,p_h)$ of \eqref{eqn::vfStokes} satisfying

$$
\| \mathbf{u}-\mathbf{u}_h\|_{1,\Omega}+\| p-p_h\|_{0,\Omega}
\le C\left(
\inf_{\mathbf{v}_h\in \mathbf{V}_h}\| u-v_h\|_{1,\Omega}
+\inf_{q_h\in W_h}\| p-q_h\|_{0,\Omega}\right)
$$

&lt;!--- __ ---&gt;

with a constant $C&gt;0$ (see e.g. [ROBERTS1993](#ROBERTS1993), Theorem 10.4).
</pre></div>
</div>
<p>Let us denote that</p>
<p><a href="#id21"><span class="problematic" id="id22">:raw-latex:`\begin{eqnarray}
A&amp;=&amp;(A_{ij}),\, A_{ij}=\int_{\Omega}\nabla \phi_j\cdot \nabla \phi_i\qquad
i,j=1,\cdots,M_{\mathbf{V}}\\
\mathbf{B}&amp;=&amp;(Bx_{ij},By_{ij}),\,
Bx_{ij}=-\int_{\Omega}\p \phi_j/\p x\, \varphi_i\qquad
By_{ij}=-\int_{\Omega}\p \phi_j/\p y\, \varphi_i\nonumber\\
&amp;&amp;\qquad i=1,\cdots,M_W;j=1,\cdots,M_V\nonumber
\end{eqnarray}`</span></a></p>
<p>then <a href="#id23"><span class="problematic" id="id24">:raw-latex:`\eqref{eqn::vfStokes}`</span></a> is written by</p>
<p><a href="#id25"><span class="problematic" id="id26">:raw-latex:`\begin{eqnarray}
\left(
\begin{array}{cc}
\mathbf{A}&amp;\mathbf{\mathbf{B}}^*\\
\mathbf{B}&amp;0
\end{array}
\right)
\left(
\begin{array}{cc}
\mathbf{U}_h\\
\{p_h\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\mathbf{F}_h\\
0
\end{array}
\right)
\end{eqnarray}`</span></a> where <a href="#id27"><span class="problematic" id="id28">:raw-latex:`\begin{eqnarray*}
&amp;&amp;\mathbf{A}=\left(
\begin{array}{cc}
A&amp;0\\
0&amp;A
\end{array}
\right)
\qquad
\mathbf{B}^*=\left\{
\begin{array}{c}
Bx^T\\
By^T
\end{array}
\right\}
\qquad
\mathbf{U}_h=\left\{
\begin{array}{c}
\{u_{1,h}\}\\
\{u_{2,h}\}
\end{array}
\right\}
\qquad
\mathbf{F}_h=\left\{
\begin{array}{c}
\{\textstyle{\int_{\Omega}f_1\phi_i}\}\\
\{\textstyle{\int_{\Omega}f_2\phi_i}\}
\end{array}
\right\}
\end{eqnarray*}`</span></a></p>
<p><strong>Penalty method:</strong> This method consists of replacing
<a href="#id29"><span class="problematic" id="id30">:raw-latex:`\eqref{eqn::vfStokes}`</span></a> by a more regular problem: Find
<span class="math notranslate nohighlight">\((\mathbf{v}_h^{\epsilon},p_h^{\epsilon})\in \mathbf{V}_h\times \tilde{W}_{h}\)</span>
satisfying</p>
<dl class="docutils">
<dt>:raw-latex:<a href="#id31"><span class="problematic" id="id32">`</span></a>begin{equation}</dt>
<dd>begin{array}{cll}
a(mathbf{u}_h^epsilon,mathbf{v}_h)+b(mathbf{v}_h,p_h^{epsilon}) &amp;= (mathbf{f},mathbf{v}_h) ,
&amp;forall mathbf{v}_{h} in mathbf{V}_{h} \
b(mathbf{u}_h^{epsilon},q_h)-epsilon(p_h^{epsilon},q_h)&amp;= 0,
&amp;forall q_{h} in tilde{W}_{h}
end{array}</dd>
</dl>
<p>end{equation}`</p>
<p>where <span class="math notranslate nohighlight">\(\tilde{W}_h\subset L^2(\Omega)\)</span>. Formally, we have</p>
<div class="math notranslate nohighlight">
\[\textrm{div}\mathbf{u}_h^{\epsilon}=\epsilon p_h^{\epsilon}\]</div>
<p>and the corresponding algebraic problem</p>
<p><a href="#id33"><span class="problematic" id="id34">:raw-latex:`\begin{eqnarray*}
\left(
\begin{array}{cc}
\mathbf{A}&amp;B^*\\
B&amp;-\epsilon I
\end{array}
\right)
\left(
\begin{array}{cc}
\mathbf{U}_h^{\epsilon}\\
\{p_h^{\epsilon}\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\mathbf{F}_h\\
0
\end{array}
\right)
\end{eqnarray*}`</span></a></p>
<p>!!! note We can eliminate
<span class="math notranslate nohighlight">\(p_h^\epsilon=(1/\epsilon)BU_h^{\epsilon}\)</span> to obtain</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>\begin{eqnarray}
\label{eqn::StiffPvfStokes}
(A+(1/\epsilon)B^*B)\mathbf{U}_h^{\epsilon}=\mathbf{F}_h^{\epsilon}
\end{eqnarray}

&lt;!--- ** ---&gt;

Since the matrix $A+(1/\epsilon)B^*B$ is symmetric, positive-definite, and sparse, \eqref{eqn::StiffPvfStokes} can be solved by known technique. There is a constant $C&gt;0$ independent of $\epsilon$ such that

&lt;!--- ** ---&gt;

$$
\|\mathbf{u}_h-\mathbf{u}_h^\epsilon\|_{1,\Omega}+
\|p_h-p_h^{\epsilon}\|_{0,\Omega}\le C\epsilon
$$

(see e.g. [ROBERTS1993](#ROBERTS1993), 17.2)
</pre></div>
</div>
<p>!!!example “Cavity” The driven cavity flow problem is solved first at
zero Reynolds number (Stokes flow) and then at Reynolds 100. The
velocity pressure formulation is used first and then the calculation is
repeated with the stream function vorticity formulation.</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>We solve the driven cavity problem by the penalty method \eqref{eqn::PvfStokes} where $\mathbf{u}_{\Gamma}\cdot \mathbf{n}=0$ and $\mathbf{u}_{\Gamma}\cdot \mathbf{s}=1$ on the top boundary and zero elsewhere ($\mathbf{n}$ is the unit normal to $\Gamma$, and $\mathbf{s}$ the unit tangent to $\Gamma$).

The mesh is constructed by

```freefem
mesh Th = square(8, 8);
```

We use a classical Taylor-Hood element technique to solve the problem:

The velocity is approximated with the $P_{2}$ FE ($X_{h}$ space), and the pressure is approximated with the $P_{1}$ FE ($M_{h}$ space), where

$$
X_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2}\right.\right\}
$$

and

$$
M_{h} = \left\{ v \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \right.\right\}
$$

The FE spaces and functions are constructed by

```freefem
fespace Xh(Th, P2); //definition of the velocity component space
fespace Mh(Th, P1); //definition of the pressure space
Xh u2, v2;
Xh u1, v1;
Mh p, q;
```

The Stokes operator is implemented as a system-solve for the velocity $(u1,u2)$ and the pressure $p$. The test function for the velocity is $(v1,v2)$ and $q$ for the pressure, so the variational form \eqref{eqn::vfStokes} in freefem language is:

```freefem
solve Stokes (u1, u2, p, v1, v2, q, solver=Crout)
    = int2d(Th)(
          (
              dx(u1)*dx(v1)
            + dy(u1)*dy(v1)
            + dx(u2)*dx(v2)
            + dy(u2)*dy(v2)
        )
        - p*q*(0.000001)
        - p*dx(v1) - p*dy(v2)
        - dx(u1)*q - dy(u2)*q
    )
    + on(3, u1=1, u2=0)
    + on(1, 2, 4, u1=0, u2=0)
    ;
```

Each unknown has its own boundary conditions.

If the streamlines are required, they can be computed by finding $\psi$ such that rot$\psi=u$ or better,

$$
-\Delta\psi=\nabla\times u
$$

```freefem
Xh psi, phi;

solve streamlines (psi, phi)
    = int2d(Th)(
          dx(psi)*dx(phi)
        + dy(psi)*dy(phi)
    )
    + int2d(Th)(
        - phi*(dy(u1) - dx(u2))
    )
    + on(1, 2, 3, 4, psi=0)
    ;
```

Now the Navier-Stokes equations are solved

$${\p {u}\over\p t} +u\cdot\nabla u-\nu \Delta u+\nabla p=0, \nabla\cdot u=0$$

with the same boundary conditions and with initial conditions $u=0$.

This is implemented by using the convection operator `:::freefem convect` for the term ${\p u\over\p t} +u\cdot\nabla u$, giving a discretization in time

\begin{equation}
\begin{array}{cl}
\frac{1}{\tau } (u^{n+1}-u^n\circ X^n) -\nu\Delta u^{n+1} + \nabla p^{n+1} &amp;=0,\\
 \nabla\cdot u^{n+1} &amp;= 0
 \end{array}
\end{equation}

The term $u^n\circ X^n(x)\approx u^n(x-u^n(x)\tau )$ will be computed by the operator `:::freefem convect`, so we obtain

```freefem
int i=0;
real alpha=1/dt;
problem NS (u1, u2, p, v1, v2, q, solver=Crout, init=i)
    = int2d(Th)(
          alpha*(u1*v1 + u2*v2)
        + nu * (
              dx(u1)*dx(v1) + dy(u1)*dy(v1)
            + dx(u2)*dx(v2) + dy(u2)*dy(v2)
        )
        - p*q*(0.000001)
        - p*dx(v1) - p*dy(v2)
        - dx(u1)*q - dy(u2)*q
    )
    + int2d(Th)(
        - alpha*convect([up1,up2],-dt,up1)*v1
        - alpha*convect([up1,up2],-dt,up2)*v2
    )
    + on(3, u1=1, u2=0)
    + on(1, 2, 4,u1=0, u2=0)
    ;

// Time loop
for (i = 0; i &lt;= 10; i++){
    // Update
    up1 = u1;
    up2 = u2;

    // Solve
    NS;

    // Plot
    if (!(i % 10))
        plot(coef=0.2, cmm=&quot;[u1,u2] and p&quot;, p, [u1, u2]);
}
```

Notice that the stiffness matrices are reused (keyword `:::freefem init=i`)

The complete script is available in [Examples](/examples/#cavity).
</pre></div>
</div>
<div class="section" id="uzawa-algorithm-and-conjugate-gradients">
<h2>Uzawa Algorithm and Conjugate Gradients<a class="headerlink" href="#uzawa-algorithm-and-conjugate-gradients" title="Permalink to this headline">¶</a></h2>
<p>We solve Stokes problem without penalty. The classical iterative method
of Uzawa is described by the algorithm (see
e.g.<a class="reference external" href="#ROBERTS1993">ROBERTS1993</a>, 17.3,
<a class="reference external" href="#GLOWINSKI1979">GLOWINSKI1979</a>, 13 or
<a class="reference external" href="#GLOWINSKI1985">GLOWINSKI1985</a>, 13):</p>
<ul>
<li><p class="first"><strong>Initialize:</strong> Let <span class="math notranslate nohighlight">\(p_h^0\)</span> be an arbitrary chosen element of
<span class="math notranslate nohighlight">\(L^2(\Omega)\)</span>.</p>
</li>
<li><p class="first"><strong>Calculate :math:`mathbf{u}_h`:</strong> Once <span class="math notranslate nohighlight">\(p_h^n\)</span> is known,
<span class="math notranslate nohighlight">\(\mathbf{v}_h^n\)</span> is the solution of</p>
<div class="math notranslate nohighlight">
\[\mathbf{u}_h^n = A^{-1}(\mathbf{f}_h-\mathbf{B}^*p_h^n)\]</div>
</li>
<li><p class="first"><strong>Advance :math:`p_h`:</strong> Let <span class="math notranslate nohighlight">\(p_h^{n+1}\)</span> be defined by</p>
<div class="math notranslate nohighlight">
\[p_h^{n+1}=p_h^n+\rho_n\mathbf{B}\mathbf{u}_h^n\]</div>
</li>
</ul>
<p>There is a constant <span class="math notranslate nohighlight">\(\alpha&gt;0\)</span> such that
<span class="math notranslate nohighlight">\(\alpha\le \rho_n\le 2\)</span> for each <span class="math notranslate nohighlight">\(n\)</span>, then
<span class="math notranslate nohighlight">\(\mathbf{u}_h^n\)</span> converges to the solution <span class="math notranslate nohighlight">\(\mathbf{u}_h\)</span>,
and then <span class="math notranslate nohighlight">\(B\mathbf{v}_h^n\to 0\)</span> as <span class="math notranslate nohighlight">\(n\to \infty\)</span> from the
<em>Advance :math:`p_h`</em>. This method in general converges quite slowly.</p>
<p>First we define mesh, and the Taylor-Hood approximation. So
<span class="math notranslate nohighlight">\(X_{h}\)</span> is the velocity space, and <span class="math notranslate nohighlight">\(M_{h}\)</span> is the pressure
space.</p>
<p>!!!example “Stokes Uzawa” ```freefem // Mesh mesh Th = square(10, 10);</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>// Fespace
fespace Xh(Th, P2);
Xh u1, u2;
Xh bc1, bc2;
Xh b;

fespace Mh(Th, P1);
Mh p;
Mh ppp; //ppp is a working pressure

// Problem
varf bx (u1, q) = int2d(Th)(-(dx(u1)*q));
varf by (u1, q) = int2d(Th)(-(dy(u1)*q));
varf a (u1, u2)
    = int2d(Th)(
          dx(u1)*dx(u2)
        + dy(u1)*dy(u2)
    )
    + on(3, u1=1)
    + on(1, 2, 4, u1=0) ;
//remark: put the on(3,u1=1) before on(1,2,4,u1=0)
//because we want zero on intersection

matrix A = a(Xh, Xh, solver=CG);
matrix Bx = bx(Xh, Mh); //B=(Bx, By)$
matrix By = by(Xh, Mh);

bc1[] = a(0,Xh); //boundary condition contribution on u1
bc2 = 0; //no boundary condition contribution on u2

//p_h^n -&gt; B A^-1 - B^* p_h^n = -div u_h
//is realized as the function divup
func real[int] divup (real[int] &amp; pp){
    //compute u1(pp)
    b[] = Bx&#39;*pp;
    b[] *= -1;
    b[] += bc1[];
    u1[] = A^-1*b[];
    //compute u2(pp)
    b[] = By&#39;*pp;
    b[] *= -1;
    b[] += bc2[];
    u2[] = A^-1*b[];
    //u^n = (A^-1 Bx^T p^n, By^T p^n)^T$
    ppp[] = Bx*u1[]; //ppp = Bx u_1
    ppp[] += By*u2[]; //+ By u_2

    return ppp[] ;
}

// Initialization
p=0; //p_h^0 = 0
LinearCG(divup, p[], eps=1.e-6, nbiter=50); //p_h^{n+1} = p_h^n + B u_h^n
// if n&gt; 50 or |p_h^{n+1} - p_h^n| &lt;= 10^-6, then the loop end
divup(p[]); //compute the final solution

plot([u1, u2], p, wait=1, value=true, coef=0.1);
```
</pre></div>
</div>
</div>
<div class="section" id="nsuzawacahouetchabart-edp">
<h2>NSUzawaCahouetChabart.edp<a class="headerlink" href="#nsuzawacahouetchabart-edp" title="Permalink to this headline">¶</a></h2>
<p>In this example we solve the Navier-Stokes equation past a cylinder with
the Uzawa algorithm preconditioned by the Cahouet-Chabart method (see
<a class="reference external" href="#GLOWINSKI2003">GLOWINSKI2003</a> for all the details).</p>
<p>The idea of the preconditioner is that in a periodic domain, all
differential operators commute and the Uzawa algorithm comes to solving
the linear operator
<span class="math notranslate nohighlight">\(\nabla. ( (\alpha Id + \nu \Delta)^{-1} \nabla\)</span>, where $ Id $ is
the identity operator. So the preconditioner suggested is
<span class="math notranslate nohighlight">\(\alpha \Delta^{-1} + \nu Id\)</span>.</p>
<p>To implement this, we do</p>
<p>!!!example “NS Uzawa Cahouet Chabart” ```freefem // Parameters
verbosity = 0;</p>
<div class="highlight-freefem notranslate"><div class="highlight"><pre><span></span>real D = 0.1;
real H = 0.41;
real cx0 = 0.2;
real cy0 = 0.2; //center of cylinder
real xa = 0.15;
real ya = 0.2;
real xe = 0.25;
real ye = 0.2;
int nn = 15;

//TODO
real Um = 1.5; //max velocity (Rey 100)
real nu = 1e-3;

func U1 = 4.*Um*y*(H-y)/(H*H); //Boundary condition
func U2 = 0.;
real T=2;
real dt = D/nn/Um; //CFL = 1
real epspq = 1e-10;
real eps = 1e-6;

// Variables
func Ub = Um*2./3.;
real alpha = 1/dt;
real Rey = Ub*D/nu;
real t = 0.;

// Mesh
border fr1(t=0, 2.2){x=t; y=0; label=1;}
border fr2(t=0, H){x=2.2; y=t; label=2;}
border fr3(t=2.2, 0){x=t; y=H; label=1;}
border fr4(t=H, 0){x=0; y=t; label=1;}
border fr5(t=2*pi, 0){x=cx0+D*sin(t)/2; y=cy0+D*cos(t)/2; label=3;}
mesh Th = buildmesh(fr1(5*nn) + fr2(nn) + fr3(5*nn) + fr4(nn) + fr5(-nn*3));

// Fespace
fespace Mh(Th, [P1]);
Mh p;

fespace Xh(Th, [P2]);
Xh u1, u2;

fespace Wh(Th, [P1dc]);
Wh w; //vorticity

// Macro
macro grad(u) [dx(u), dy(u)] //
macro div(u1, u2) (dx(u1) + dy(u2)) //

// Problem
varf von1 ([u1, u2, p], [v1, v2, q])
    = on(3, u1=0, u2=0)
    + on(1, u1=U1, u2=U2)
    ;

//remark : the value 100 in next varf is manualy fitted, because free outlet.
varf vA (p, q) =
    int2d(Th)(
          grad(p)&#39; * grad(q)
    )
    + int1d(Th, 2)(
          100*p*q
    )
    ;

varf vM (p, q)
    = int2d(Th, qft=qf2pT)(
          p*q
    )
    + on(2, p=0)
    ;

varf vu ([u1], [v1])
    = int2d(Th)(
          alpha*(u1*v1)
        + nu*(grad(u1)&#39; * grad(v1))
    )
    + on(1, 3, u1=0)
    ;

varf vu1 ([p], [v1]) = int2d(Th)(p*dx(v1));
varf vu2 ([p], [v1]) = int2d(Th)(p*dy(v1));

varf vonu1 ([u1], [v1]) = on(1, u1=U1) + on(3, u1=0);
varf vonu2 ([u1], [v1]) = on(1, u1=U2) + on(3, u1=0);

matrix pAM = vM(Mh, Mh, solver=UMFPACK);
matrix pAA = vA(Mh, Mh, solver=UMFPACK);
matrix AU = vu(Xh, Xh, solver=UMFPACK);
matrix B1 = vu1(Mh, Xh);
matrix B2 = vu2(Mh, Xh);

real[int] brhs1 = vonu1(0, Xh);
real[int] brhs2 = vonu2(0, Xh);

varf vrhs1(uu, vv) = int2d(Th)(convect([u1, u2], -dt, u1)*vv*alpha) + vonu1;
varf vrhs2(v2, v1) = int2d(Th)(convect([u1, u2], -dt, u2)*v1*alpha) + vonu2;

// Uzawa function
func real[int] JUzawa (real[int] &amp; pp){
    real[int] b1 = brhs1; b1 += B1*pp;
    real[int] b2 = brhs2; b2 += B2*pp;
    u1[] = AU^-1 * b1;
    u2[] = AU^-1 * b2;
    pp = B1&#39;*u1[];
    pp += B2&#39;*u2[];
    pp = -pp;
    return pp;
}

// Preconditioner function
func real[int] Precon (real[int] &amp; p){
    real[int] pa = pAA^-1*p;
    real[int] pm = pAM^-1*p;
    real[int] pp = alpha*pa + nu*pm;
    return pp;
}

// Initialization
p = 0;

// Time loop
int ndt = T/dt;
for(int i = 0; i &lt; ndt; ++i){
    // Update
    brhs1 = vrhs1(0, Xh);
    brhs2 = vrhs2(0, Xh);

    // Solve
    int res = LinearCG(JUzawa, p[], precon=Precon, nbiter=100, verbosity=10, veps=eps);
    assert(res==1);
    eps = -abs(eps);

    // Vorticity
    w = -dy(u1) + dx(u2);
    plot(w, fill=true, wait=0, nbiso=40);

    // Update
    dt = min(dt, T-t);
    t += dt;
    if(dt &lt; 1e-10*T) break;
}

// Plot
plot(w, fill=true, nbiso=40);

// Display
cout &lt;&lt; &quot;u1 max = &quot; &lt;&lt; u1[].linfty
     &lt;&lt; &quot;, u2 max = &quot; &lt;&lt; u2[].linfty
     &lt;&lt; &quot;, p max = &quot; &lt;&lt; p[].max &lt;&lt; endl;
```

!!!warning &quot;Stop test of the conjugate gradient&quot;
    Because we start from the previous solution and the end the previous solution is close to the final solution, don&#39;t take a relative stop test to the first residual, take an absolute stop test (negative here).
</pre></div>
</div>
<p>&lt;table border=”1” class=”docutils”&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=”center”&gt;&lt;a name=”Fig24”&gt;Fig. 24&lt;/a&gt;: The vorticity at Reynolds number 100 a time 2s with the Cahouet-Chabart method.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=”center”&gt;&lt;img alt=”NSCahouetChabart” src=”images/NavierStokesEquations.png” /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[TEMAM1977] TEMAM, Roger. Navier-Stokes equations: theory and numerical
analysis. 1977.</p>
<p>[ROBERTS1993] ROBERTS, J. E. et THOMAS, J. M. Mixed and Hybrid Methods,
Handbook of Numerical Anaysis, Vol. II. North-Holland, 1993, vol.&nbsp;183,
p.&nbsp;184.</p>
<p>&lt;a name“GLOWINSKI1979”&gt;[GLOWINSKI1979] GLOWINSKI, R. et PIRONNEAU, O. On
numerical methods for the Stokes problem. In: Energy methods in finite
element analysis.(A79-53076 24-39) Chichester, Sussex, England,
Wiley-Interscience, 1979, p.&nbsp;243-264., 1979, p.&nbsp;243-264.</p>
<p>[GLOWINSKI1985] GLOWINSKI, Roland et ODEN, J. Tinsley. Numerical methods
for nonlinear variational problems. Journal of Applied Mechanics, 1985,
vol.&nbsp;52, p.&nbsp;739.</p>
<p>[GLOWINSKI2003] GLOWINSKI, Roland. Finite element methods for
incompressible viscous flow. Handbook of numerical analysis, 2003,
vol.&nbsp;9, p.&nbsp;3-1176.</p>
</div>
</div>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
<div class="localtoc">
    <p class="caption">
      <span class="caption-text">Table Of Contents</span>
    </p>
    <ul>
<li><a class="reference internal" href="#">Navier-Stokes equations</a><ul>
<li><a class="reference internal" href="#uzawa-algorithm-and-conjugate-gradients">Uzawa Algorithm and Conjugate Gradients</a></li>
<li><a class="reference internal" href="#nsuzawacahouetchabart-edp">NSUzawaCahouetChabart.edp</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

</div>
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="evolutionProblems.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Evolution problems</div>
         </div>
     </a>
     <a id="button-next" href="variationalInequality.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>Variational Inequality</div>
        </div>
     </a>
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FreeFem++</div>
      <div>
        
        <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Language references</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Mathematical Models</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2018, FreeFem++.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.3 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>