git:
    submodules: false

notifications:
    email: false

language: generic

before_install:
    - sudo apt update
    - sudo apt install nodejs npm
    - sudo pip install --upgrade pip
    - sudo pip install Sphinx
    - sudo pip install sphinxcontrib-inlinesyntaxhighlight
    - sudo apt install texlive-latex-recommended texlive-fonts-recommended texlive-latex-extra
    - git clone https://github.com/FreeFem/FreeFem-parser-pygments.git ~/pygments
    - sudo cp ~/pygments/freefem.py /usr/local/lib/python2.7/dist-packages/pygments/lexers/
    - cd /usr/local/lib/python2.7/dist-packages/pygments/lexers/ && sudo python _mapping.py
    - cd /home/travis/build/FreeFem/${GH_REPOSITORY}

script:
    - make html
    - make latex
    - cd build/latex && pdflatex -interaction=nonstopmode FreeFem++.tex && pdflatex -interaction=nonstopmode FreeFem++.tex && cd ../..
    - cp -R build/html ..
    - cp -R build/latex ..

after_success:
    - git config user.name "sgarnotel"
    - git config user.email "simon.garnotel@gmail.com"
    - git remote add gh-token "https://${GH_TOKEN}@github.com/FreeFem/${GH_REPOSITORY}.git" > /dev/null 2>&1
    - git fetch gh-token && git fetch gh-token gh-pages:gh-pages
    - git checkout gh-pages && git clean -f -d && cp -R ../html/* . && git add --all && git commit -m"update Web" && git push --set-upstream origin gh-pages
    - git fetch gh-token && git fetch gh-token pdf:pdf
    - git checkout pdf && git clean -f -d && cp ../latex/FreeFem++.pdf ./ && git add FreeFem++.pdf && git commit -m"update PDF" && git push --set-upstream origin pdf
